<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="time#time 提供了一个数据类型 time.Time（作为值使用）以及显示和测量时间和日期的功能函数，比如：
time.Now() 获取当前时间。 t.Day()、t.Minute() 获取时间的一部分。 time.After、time.Ticker 在经过一定时间或周期执行某项任务（事件处理的特例）。 time.Sleep（Duration d） 暂停某个进程（ goroutine），暂停时长为 d。 Duration 代表两个时间点之间经过的时间，以纳秒为单位，类型为 int64。 Location 类型映射某个时区的时间，UTC 表示通用协调世界时间。 时区#Go 语言使用 Location 来表示地区相关的时区，一个 Location 可能表示多个时区。
time 包提供了 Location 的两个实例：
Local 代表当前系统本地时区； UTC 代表通用协调时间，也就是零时区。time 包默认（为显示提供时区）使用 UTC 时区。 Local 是如何做到表示本地时区的？#在初始化 Local 时，通过读取 /etc/localtime （这是一个符号链接，指向 /usr/share/zoneinfo 中某一个时区）可以获取到系统本地时区。
如果设置了环境变量 TZ，则会优先使用它。
tz, ok := syscall.Getenv(&#34;TZ&#34;) switch { case !ok: z, err := loadZoneFile(&#34;&#34;, &#34;/etc/localtime&#34;) if err == nil { localLoc = *z localLoc.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="time" />
<meta property="og:description" content="time#time 提供了一个数据类型 time.Time（作为值使用）以及显示和测量时间和日期的功能函数，比如：
time.Now() 获取当前时间。 t.Day()、t.Minute() 获取时间的一部分。 time.After、time.Ticker 在经过一定时间或周期执行某项任务（事件处理的特例）。 time.Sleep（Duration d） 暂停某个进程（ goroutine），暂停时长为 d。 Duration 代表两个时间点之间经过的时间，以纳秒为单位，类型为 int64。 Location 类型映射某个时区的时间，UTC 表示通用协调世界时间。 时区#Go 语言使用 Location 来表示地区相关的时区，一个 Location 可能表示多个时区。
time 包提供了 Location 的两个实例：
Local 代表当前系统本地时区； UTC 代表通用协调时间，也就是零时区。time 包默认（为显示提供时区）使用 UTC 时区。 Local 是如何做到表示本地时区的？#在初始化 Local 时，通过读取 /etc/localtime （这是一个符号链接，指向 /usr/share/zoneinfo 中某一个时区）可以获取到系统本地时区。
如果设置了环境变量 TZ，则会优先使用它。
tz, ok := syscall.Getenv(&#34;TZ&#34;) switch { case !ok: z, err := loadZoneFile(&#34;&#34;, &#34;/etc/localtime&#34;) if err == nil { localLoc = *z localLoc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://shipengqi.github.io/golang-learn/docs/standards/time/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2023-10-07T14:03:42+08:00" />
<title>time | Golang Learning</title>
<link rel="manifest" href="/golang-learn/manifest.json">
<link rel="icon" href="/golang-learn/favicon.png" >
<link rel="stylesheet" href="/golang-learn/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css" integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz&#43;OQteg=" crossorigin="anonymous">
  <script defer src="/golang-learn/flexsearch.min.js"></script>
  <script defer src="/golang-learn/en.search.min.3ac681a53da45dac77797598a45cf2027512a88ff06593f14d801b3f9783344c.js" integrity="sha256-OsaBpT2kXax3eXWYpFzyAnUSqI/wZZPxTYAbP5eDNEw=" crossorigin="anonymous"></script>

  <script defer src="/golang-learn/sw.min.e9a55528e030e44ecbe1b5a8da7dd8fb40bd282d02dc4574e81b999a6a21bc84.js" integrity="sha256-6aVVKOAw5E7L4bWo2n3Y&#43;0C9KC0C3EV06BuZmmohvIQ=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/golang-learn/"><span>Golang Learning</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>







  
<ul>
  
  <li>
    <a href="https://github.com/shipengqi/golang-learn"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://shipengqi.github.io/"  target="_blank" rel="noopener">
        Blog
      </a>
  </li>
  
</ul>







  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>语言基础</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/map/" class="">map</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/slice/" class="">slice</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/scope/" class="">作用域</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/function/" class="">函数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/package/" class="">包</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/reflect/" class="">反射</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/var/" class="">变量</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/basic_data/" class="">基础据类型</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/constant/" class="">常量</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/json/" class="">序列化</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/pointer/" class="">指针</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/interface/" class="">接口</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/flow/" class="">控制语句</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/array/" class="">数组</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/test/" class="">测试</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/struct/" class="">结构体</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/operator/" class="">运算符</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/error/" class="">错误</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/oop/" class="">面向对象</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>并发编程</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/concurrent/channel/" class="">channel</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/concurrent/goroutine/" class="">goroutine</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/concurrent/sync_lock/" class="">同步和锁</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/concurrent/concurrent/" class="">并发和并行</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>常用命令</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/build/" class="">build</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/doc/" class="">doc</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/env/" class="">env</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/fmt/" class="">fmt</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/get/" class="">get</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/summary/" class="">Go 命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/golint/" class="">golint</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/install/" class="">install</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/mod/" class="">mod</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/run/" class="">run</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/test/" class="">test</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/tool/" class="">tool</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/vet/" class="">vet</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>常用标准库</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <span>data</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/data/big/" class="">big</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/data/container/" class="">container</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/data/math/" class="">math</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/data/sort/" class="">sort</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>database</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/database/sql/" class="">sql</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>io</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/io/bufio/" class="">bufio</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/io/fmt/" class="">fmt</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/io/io/" class="">io</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/io/ioutil/" class="">ioutil</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/log/" class="">log</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <span>net</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/net/http/" class="">http</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/os/" class="">os</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/os/filepath/" class="">filepath</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>text</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/text/strconv/" class="">strconv</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/text/strings/" class="">strings</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/text/unicode/" class="">unicode</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/time/" class="active">time</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/unsafe/" class="">unsafe</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>实践</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/gin/" class="">Gin</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/ginkgo/" class="">Ginkgo</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/pprof/" class="">Go PProf</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/trace/" class="">Go trace</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/go-race/" class="">Go 数据竞争检测器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/go_relative_path/" class="">Go 的相对路径</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/build/" class="">Golang 条件编译</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/json/" class="">Json Unmarshal</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/errors/" class="">错误处理</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>底层原理</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/advance/scheduler/" class="">Goroutine 调度器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/advance/mm/" class="">内存分配</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/advance/gc/" class="">垃圾回收</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/golang-learn/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>time</strong>

  <label for="toc-control">
    
    <img src="/golang-learn/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#time">time</a>
      <ul>
        <li><a href="#时区">时区</a>
          <ul>
            <li><a href="#local-是如何做到表示本地时区的">Local 是如何做到表示本地时区的？</a></li>
            <li><a href="#获得特定时区的实例">获得特定时区的实例</a></li>
          </ul>
        </li>
        <li><a href="#time-1">Time</a>
          <ul>
            <li><a href="#常用方法">常用方法</a></li>
          </ul>
        </li>
        <li><a href="#定时器">定时器</a>
          <ul>
            <li><a href="#timer">Timer</a></li>
            <li><a href="#常用方法-1">常用方法</a></li>
          </ul>
        </li>
        <li><a href="#ticker">Ticker</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="time">
  time
  <a class="anchor" href="#time">#</a>
</h1>
<p><code>time</code> 提供了一个数据类型 <code>time.Time</code>（作为值使用）以及显示和测量时间和日期的功能函数，比如：</p>
<ul>
<li><code>time.Now()</code> 获取当前时间。</li>
<li><code>t.Day()</code>、<code>t.Minute()</code> 获取时间的一部分。</li>
<li><code>time.After</code>、<code>time.Ticker</code> 在经过一定时间或周期执行某项任务（事件处理的特例）。</li>
<li><code>time.Sleep（Duration d）</code> 暂停某个进程（ goroutine），暂停时长为 <code>d</code>。</li>
<li><code>Duration</code> 代表两个时间点之间经过的时间，以<strong>纳秒</strong>为单位，类型为 <code>int64</code>。</li>
<li><code>Location</code> 类型映射某个时区的时间，UTC 表示通用协调世界时间。</li>
</ul>
<h2 id="时区">
  时区
  <a class="anchor" href="#%e6%97%b6%e5%8c%ba">#</a>
</h2>
<p>Go 语言使用 <code>Location</code> 来表示地区相关的时区，一个 <code>Location</code> 可能表示多个时区。</p>
<p><code>time</code> 包提供了 <code>Location</code> 的两个实例：</p>
<ul>
<li><code>Local</code> 代表当前系统本地时区；</li>
<li><code>UTC</code> 代表通用协调时间，也就是零时区。<code>time</code> 包默认（为显示提供时区）使用 <code>UTC</code> 时区。</li>
</ul>
<h3 id="local-是如何做到表示本地时区的">
  Local 是如何做到表示本地时区的？
  <a class="anchor" href="#local-%e6%98%af%e5%a6%82%e4%bd%95%e5%81%9a%e5%88%b0%e8%a1%a8%e7%a4%ba%e6%9c%ac%e5%9c%b0%e6%97%b6%e5%8c%ba%e7%9a%84">#</a>
</h3>
<p>在初始化 <code>Local</code> 时，通过读取 <code>/etc/localtime</code> （这是一个符号链接，指向 <code>/usr/share/zoneinfo</code> 中某一个时区）可以获取到系统本地时区。</p>
<p>如果设置了<strong>环境变量 <code>TZ</code></strong>，则会优先使用它。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">tz</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">syscall</span>.<span style="color:#a6e22e">Getenv</span>(<span style="color:#e6db74">&#34;TZ&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">switch</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> !<span style="color:#a6e22e">ok</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">z</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">loadZoneFile</span>(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;/etc/localtime&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">localLoc</span> = <span style="color:#f92672">*</span><span style="color:#a6e22e">z</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">localLoc</span>.<span style="color:#a6e22e">name</span> = <span style="color:#e6db74">&#34;Local&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#a6e22e">tz</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">tz</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;UTC&#34;</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">z</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">loadLocation</span>(<span style="color:#a6e22e">tz</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">localLoc</span> = <span style="color:#f92672">*</span><span style="color:#a6e22e">z</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="获得特定时区的实例">
  获得特定时区的实例
  <a class="anchor" href="#%e8%8e%b7%e5%be%97%e7%89%b9%e5%ae%9a%e6%97%b6%e5%8c%ba%e7%9a%84%e5%ae%9e%e4%be%8b">#</a>
</h3>
<p>函数 <code>LoadLocation</code> 可以根据名称获取特定时区的实例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">LoadLocation</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Location</span>, <span style="color:#66d9ef">error</span>)
</span></span></code></pre></div><p>如果 <code>name</code> 是 &quot;&quot; 或 &ldquo;UTC&rdquo;，返回 UTC；
如果 <code>name</code> 是 &ldquo;Local&rdquo;，返回 <code>Local</code>；
否则 <code>name</code> 应该是 IANA 时区数据库里有记录的地点名（该数据库记录了地点和对应的时区），如 &ldquo;America/New_York&rdquo;。</p>
<h2 id="time-1">
  Time
  <a class="anchor" href="#time-1">#</a>
</h2>
<p><code>Time</code> 代表一个纳秒精度的时间点。程序中应使用 <code>time.Time</code> 类型值来保存和传递时间，而不是指针。
程序中应使用 Time 类型值来保存和传递时间，而不是指针。
一个 Time 类型值可以被多个 go 协程同时使用。时间点可以使用 Before、After 和 Equal 方法进行比较。Sub 方法让两个时间点相减，
生成一个 Duration 类型值（代表时间段）。Add 方法给一个时间点加上一个时间段，生成一个新的 Time 类型时间点。</p>
<p><code>Time</code> 零值代表时间点 <code>January 1, year 1, 00:00:00.000000000 UTC</code>。因为本时间点一般不会出现在使用中，<code>IsZero</code> 方法提供
了检验时间是否是显式初始化的一个简单途径。</p>
<p>每一个 <code>Time</code> 都具有一个地点信息（即对应地点的时区信息），当计算时间的表示格式时，如 Format、Hour 和 Year 等方法，
都会考虑该信息。Local、UTC 和 In 方法返回一个指定时区（但指向同一时间点）的 Time。修改地点 / 时区信息只是会改变其表示；不会修改被表
示的时间点，因此也不会影响其计算。</p>
<p>通过 <code>==</code> 比较 Time 时，Location 信息也会参与比较，因此 Time 不应该作为 map 的 key。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Time</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// sec gives the number of seconds elapsed since
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// January 1, year 1 00:00:00 UTC.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">sec</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// nsec specifies a non-negative nanosecond
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// offset within the second named by Seconds.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// It must be in the range [0, 999999999].
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">nsec</span> <span style="color:#66d9ef">int32</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// loc specifies the Location that should be used to
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// determine the minute, hour, month, day, and year
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// that correspond to this Time.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// Only the zero Time has a nil Location.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// In that case it is interpreted to mean UTC.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">loc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Location</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>先看 <code>time.Now()</code> 函数。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Now returns the current local time.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Now</span>() <span style="color:#a6e22e">Time</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sec</span>, <span style="color:#a6e22e">nsec</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">now</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Time</span>{<span style="color:#a6e22e">sec</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">unixToInternal</span>, <span style="color:#a6e22e">nsec</span>, <span style="color:#a6e22e">Local</span>}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>now()</code> 的具体实现在 <code>runtime</code> 包中。从 <code>Time{sec + unixToInternal, nsec, Local}</code> 可以看出，<code>Time</code> 结构的 <code>sec</code> 并非 Unix
时间戳，实际上，加上的 <code>unixToInternal</code> 是 <code>1-1-1</code> 到 <code>1970-1-1</code> 经历的秒数。也就是 <code>Time</code> 中的 <code>sec</code> 是从 <code>1-1-1</code> 算起的秒数，
而不是 Unix 时间戳。</p>
<p><code>Time</code> 的最后一个字段表示地点时区信息。本章后面会专门介绍。</p>
<h3 id="常用方法">
  常用方法
  <a class="anchor" href="#%e5%b8%b8%e7%94%a8%e6%96%b9%e6%b3%95">#</a>
</h3>
<ul>
<li><code>Time.IsZero()</code> 函数用于判断 Time 表示的时间是否是 0 值。表示 1 年 1 月 1 日。</li>
<li><code>time.Unix(sec, nsec int64</code>) 通过 Unix 时间戳生成 <code>time.Time</code> 实例；</li>
<li><code>time.Time.Unix()</code> 得到 Unix 时间戳；</li>
<li><code>time.Time.UnixNano()</code> 得到 Unix 时间戳的纳秒表示；</li>
<li><code>time.Parse</code> 和 <code>time.ParseInLocation</code></li>
<li><code>time.Time.Format</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#e6db74">&#34;2006-01-02 15:04:05&#34;</span>, <span style="color:#e6db74">&#34;2016-06-13 09:14:00&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Sub</span>(<span style="color:#a6e22e">t</span>).<span style="color:#a6e22e">Hours</span>())
</span></span></code></pre></div><p>这段代码的结果跟预期的不一样。原因是 <code>time.Now()</code> 的时区是 <code>time.Local</code>，而 <code>time.Parse</code> 解析出来的时区却是 <code>time.UTC</code>
（可以通过 <code>Time.Location()</code> 函数知道是哪个时区）。在中国，它们相差 8 小时。</p>
<p>所以，一般的，我们应该总是使用 <code>time.ParseInLocation</code> 来解析时间，并给第三个参数传递 <code>time.Local</code>。</p>
<h4 id="为什么是-2006-01-02-150405">
  为什么是 2006-01-02 15:04:05
  <a class="anchor" href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%98%af-2006-01-02-150405">#</a>
</h4>
<p>可能你已经注意到：<code>2006-01-02 15:04:05</code> 这个字符串了。没错，这是固定写法，类似于其他语言中 <code>Y-m-d H:i:s</code> 等。为什么采用这种形式？
又为什么是这个时间点而不是其他时间点？</p>
<ul>
<li>官方说，使用具体的时间，比使用 <code>Y-m-d H:i:s</code> 更容易理解和记忆；</li>
<li>而选择这个时间点，也是出于好记的考虑，官方的例子：<code>Mon Jan 2 15:04:05 MST 2006</code>，很好记：2006 年 1 月 2 日 3 点 4 分 5 秒</li>
</ul>
<h4 id="round-和-truncate-方法">
  Round 和 Truncate 方法
  <a class="anchor" href="#round-%e5%92%8c-truncate-%e6%96%b9%e6%b3%95">#</a>
</h4>
<p>比如，有这么个需求：获取当前时间整点的 <code>Time</code> 实例。例如，当前时间是 <code>15:54:23</code>，需要的是 <code>15:00:00</code>。我们可以这么做：</p>
<pre tabindex="0"><code>t, _ := time.ParseInLocation(&#34;2006-01-02 15:04:05&#34;, time.Now().Format(&#34;2006-01-02 15:00:00&#34;), time.Local)
fmt.Println(t)
</code></pre><p>实际上，<code>time</code> 包给我们提供了专门的方法，功能更强大，性能也更好，这就是 <code>Round</code> 和 <code>Trunate</code>，它们区别，一个是取最接近的，一个是向下取整。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">ParseInLocation</span>(<span style="color:#e6db74">&#34;2006-01-02 15:04:05&#34;</span>, <span style="color:#e6db74">&#34;2016-06-13 15:34:39&#34;</span>, <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Local</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 整点（向下取整）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Truncate</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Hour</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 整点（最接近）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Round</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Hour</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 整分（向下取整）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Truncate</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Minute</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 整分（最接近）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Round</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Minute</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">t2</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">ParseInLocation</span>(<span style="color:#e6db74">&#34;2006-01-02 15:04:05&#34;</span>, <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Format</span>(<span style="color:#e6db74">&#34;2006-01-02 15:00:00&#34;</span>), <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Local</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t2</span>)
</span></span></code></pre></div><h4 id="format">
  Format
  <a class="anchor" href="#format">#</a>
</h4>
<p>自定义时间格式化字符串，例如： <code>fmt.Printf(&quot;%02d.%02d.%4d\n&quot;, t.Day(), t.Month(), t.Year())</code> 将会输出 <code>21.07.2011</code>。</p>
<p>包中的一个预定义函数 <code>func (t Time) Format(layout string) string</code> 可以根据一个格式化字符串来将一个时间 t 转换为相应
格式的字符串，你可以使用一些预定义的格式，如：<code>time.ANSIC</code> 或 <code>time.RFC822</code>。</p>
<p>一般的格式化设计是通过对于一个标准时间的格式化描述来展现的，示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Format</span>(<span style="color:#e6db74">&#34;02 Jan 2006 15:04&#34;</span>)) <span style="color:#75715e">// 21 Jul 2011 10:31
</span></span></span></code></pre></div><p>示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">week</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>) <span style="color:#75715e">// e.g. Wed Dec 21 09:52:14 +0100 RST 2011
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%02d.%02d.%4d\n&#34;</span>, <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Day</span>(), <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Month</span>(), <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Year</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 21.12.2011
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">t</span> = <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">UTC</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>) <span style="color:#75715e">// Wed Dec 21 08:52:14 +0000 UTC 2011
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()) <span style="color:#75715e">// Wed Dec 21 09:52:14 +0100 RST 2011
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// calculating times:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">week</span> = <span style="color:#ae81ff">60</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">24</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">7</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1e9</span> <span style="color:#75715e">// must be in nanosec
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">week_from_now</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>(<span style="color:#a6e22e">week</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">week_from_now</span>) <span style="color:#75715e">// Wed Dec 28 08:52:14 +0000 UTC 2011
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// formatting times:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Format</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">RFC822</span>)) <span style="color:#75715e">// 21 Dec 11 0852 UTC
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Format</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">ANSIC</span>)) <span style="color:#75715e">// Wed Dec 21 08:56:34 2011
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Format</span>(<span style="color:#e6db74">&#34;02 Jan 2006 15:04&#34;</span>)) <span style="color:#75715e">// 21 Dec 2011 08:52
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Format</span>(<span style="color:#e6db74">&#34;20060102&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">t</span>, <span style="color:#e6db74">&#34;=&gt;&#34;</span>, <span style="color:#a6e22e">s</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Wed Dec 21 08:52:14 +0000 UTC 2011 =&gt; 20111221
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>示例，计算函数执行时间：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">start</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>() <span style="color:#75715e">// 起始时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">longCalculation</span>()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">end</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>() <span style="color:#75715e">// 结束时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">delta</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">end</span>.<span style="color:#a6e22e">Sub</span>(<span style="color:#a6e22e">start</span>) <span style="color:#75715e">// 消耗时间
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;longCalculation took this amount of time: %s\n&#34;</span>, <span style="color:#a6e22e">delta</span>)
</span></span></code></pre></div><h2 id="定时器">
  定时器
  <a class="anchor" href="#%e5%ae%9a%e6%97%b6%e5%99%a8">#</a>
</h2>
<p><code>time</code> 包有两种定时器：</p>
<ul>
<li><code>Timer</code>（到达指定时间触发且只触发一次）</li>
<li><code>Ticker</code>（间隔特定时间触发）。</li>
</ul>
<h3 id="timer">
  Timer
  <a class="anchor" href="#timer">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Timer</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">C</span> <span style="color:#f92672">&lt;-</span><span style="color:#66d9ef">chan</span> <span style="color:#a6e22e">Time</span>	 <span style="color:#75715e">// The channel on which the time is delivered.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">r</span> <span style="color:#a6e22e">runtimeTimer</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Timer</code> 的实例必须通过 <code>NewTimer</code> 或 <code>AfterFunc</code> 获得。
<strong>当 <code>Timer</code> 到期时，当时的时间会被发送给 <code>C</code> (channel)，除非 <code>Timer</code> 是被 <code>AfterFunc</code> 函数创建的</strong>。</p>
<p><code>runtimeTimer</code> 定义在 <code>sleep.go</code> 文件中，必须和 <code>runtime</code> 包中 <code>time.go</code> 文件中的 <code>timer</code> 保持一致：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">timer</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span> <span style="color:#75715e">// heap index
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Timer wakes up at when, and then at when+period, ... (period &gt; 0 only)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// each time calling f(now, arg) in the timer goroutine, so f must be
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// a well-behaved function and not block.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">when</span>   <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">period</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">f</span>      <span style="color:#66d9ef">func</span>(<span style="color:#66d9ef">interface</span>{}, <span style="color:#66d9ef">uintptr</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">arg</span>    <span style="color:#66d9ef">interface</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">seq</span>    <span style="color:#66d9ef">uintptr</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>通过 <code>NewTimer()</code> 来看这些字段：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// NewTimer creates a new Timer that will send
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// the current time on its channel after at least duration d.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewTimer</span>(<span style="color:#a6e22e">d</span> <span style="color:#a6e22e">Duration</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Timer</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#a6e22e">Time</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Timer</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">C</span>: <span style="color:#a6e22e">c</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">r</span>: <span style="color:#a6e22e">runtimeTimer</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">when</span>: <span style="color:#a6e22e">when</span>(<span style="color:#a6e22e">d</span>),
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">f</span>:    <span style="color:#a6e22e">sendTime</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">arg</span>:  <span style="color:#a6e22e">c</span>,
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">startTimer</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">t</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>在 <code>when</code> 表示的时间到时，会往 <code>Timer.C</code> 中发送当前时间。<code>when</code> 表示的时间是纳秒时间，正常通过 <code>runtimeNano() + int64(d)</code> 赋值。</p>
<p><code>f</code> 参数的值是 <code>sendTime</code>，定时器时间到时，会调用 <code>f</code>，并将 <code>arg</code> 和 <code>seq</code> 传给 <code>f</code>。</p>
<p>因为 <code>Timer</code> 是一次性的，所以 <code>period</code> 保留默认值 0。</p>
<h3 id="常用方法-1">
  常用方法
  <a class="anchor" href="#%e5%b8%b8%e7%94%a8%e6%96%b9%e6%b3%95-1">#</a>
</h3>
<h4 id="timeafter">
  time.After
  <a class="anchor" href="#timeafter">#</a>
</h4>
<p><code>time.After</code> 模拟超时：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// time.Sleep(1 * time.Second)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">c</span>
</span></span><span style="display:flex;"><span>}()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">select</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;channel...&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">case</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">After</span>(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>):
</span></span><span style="display:flex;"><span>	close(<span style="color:#a6e22e">c</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;timeout...&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="timestop-和-timereset">
  time.Stop 和 time.Reset
  <a class="anchor" href="#timestop-%e5%92%8c-timereset">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">start</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">timer</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">AfterFunc</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>, <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;after func callback, elaspe:&#34;</span>, <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Sub</span>(<span style="color:#a6e22e">start</span>))
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// time.Sleep(3*time.Second)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Reset 在 Timer 还未触发时返回 true；触发了或 Stop 了，返回 false
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">timer</span>.<span style="color:#a6e22e">Reset</span>(<span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;timer has not trigger!&#34;</span>)
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;timer had expired or stop!&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// output:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// timer has not trigger!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// after func callback, elaspe: 4.00026461s
</span></span></span></code></pre></div><p><code>timer.Stop()</code> 不会关闭 <code>Timer.C</code> 这个 channel，可以使用 <code>timer.Reset(0)</code> 代替 <code>timer.Stop()</code> 来停止定时器。</p>
<h4 id="sleep">
  Sleep
  <a class="anchor" href="#sleep">#</a>
</h4>
<p><code>Sleep</code> 的是通过 <code>Timer</code> 实现的（查看 <code>runtime/time.go</code> 文件）。用于暂停当前 goroutine。</p>
<h2 id="ticker">
  Ticker
  <a class="anchor" href="#ticker">#</a>
</h2>
<p><code>Ticker</code> 和 <code>Timer</code> 类似，区别是：<code>Ticker</code> 中的 <code>runtimeTimer</code> 字段的 <code>period</code> 字段会赋值为 <code>NewTicker(d Duration)</code> 中的 <code>d</code>，
表示每间隔 <code>d</code> 纳秒，定时器就会触发一次。</p>
<p>除非程序终止前定时器一直需要触发，否则，不需要时应该调用 <code>Ticker.Stop</code> 来释放相关资源。</p>
<p>如果程序终止前需要定时器一直触发，可以使用更简单方便的 <code>time.Tick</code> 函数，因为 <code>Ticker</code> 实例隐藏起来了，因此，该函数启动的定时器无法停止。</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/shipengqi/golang-learn/commit/44c3ee763ef8b1ef68e8f73c9152c5aa565995fc" title='Last modified by shipengqi | October 7, 2023' target="_blank" rel="noopener">
      <img src="/golang-learn/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>October 7, 2023</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/shipengqi/golang-learn/edit/master/content/docs/standards/time.md" target="_blank" rel="noopener">
      <img src="/golang-learn/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#time">time</a>
      <ul>
        <li><a href="#时区">时区</a>
          <ul>
            <li><a href="#local-是如何做到表示本地时区的">Local 是如何做到表示本地时区的？</a></li>
            <li><a href="#获得特定时区的实例">获得特定时区的实例</a></li>
          </ul>
        </li>
        <li><a href="#time-1">Time</a>
          <ul>
            <li><a href="#常用方法">常用方法</a></li>
          </ul>
        </li>
        <li><a href="#定时器">定时器</a>
          <ul>
            <li><a href="#timer">Timer</a></li>
            <li><a href="#常用方法-1">常用方法</a></li>
          </ul>
        </li>
        <li><a href="#ticker">Ticker</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












