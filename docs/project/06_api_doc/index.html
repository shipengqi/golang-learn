<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="API 文档 # 使用 Swagger 生成 API 文档 # Swagger 是基于 OpenAPI 规范的 API 文档工具。
OpenAPI 是一个 API 规范，它的前身就是 Swagger 规范，目前最新的 OpenAPI 规范是 OpenAPI 3.0（也就是 Swagger 2.0 规范）。
Swagger 编辑器 # Swagger 编辑是一个在线的 API 文档编辑器，可以在其中编写 OpenAPI 规范，并实时预览 API 文档。
基于代码自动生成 Swagger 文档 # Go 生成 Swagger 文档常用的工具有两个，分别是 swag 和 go-swagger。
推荐使用 go-swagger：
go-swagger 提供了更灵活、更多的功能来描述 API，可以生成客户端和服务器端代码。 使用 swag 的话，每一个 API 都需要有一个冗长的注释，有时候代码注释比代码还要长，但是通过 go-swagger 可以将代码和注释分开编写，可以使代码保持简洁，清晰易读，而且可以把 API 定义放在一个目录中，方便管理。 安装 go-swagger # $ go get -u github."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="API 文档"><meta property="og:description" content="API 文档 # 使用 Swagger 生成 API 文档 # Swagger 是基于 OpenAPI 规范的 API 文档工具。
OpenAPI 是一个 API 规范，它的前身就是 Swagger 规范，目前最新的 OpenAPI 规范是 OpenAPI 3.0（也就是 Swagger 2.0 规范）。
Swagger 编辑器 # Swagger 编辑是一个在线的 API 文档编辑器，可以在其中编写 OpenAPI 规范，并实时预览 API 文档。
基于代码自动生成 Swagger 文档 # Go 生成 Swagger 文档常用的工具有两个，分别是 swag 和 go-swagger。
推荐使用 go-swagger：
go-swagger 提供了更灵活、更多的功能来描述 API，可以生成客户端和服务器端代码。 使用 swag 的话，每一个 API 都需要有一个冗长的注释，有时候代码注释比代码还要长，但是通过 go-swagger 可以将代码和注释分开编写，可以使代码保持简洁，清晰易读，而且可以把 API 定义放在一个目录中，方便管理。 安装 go-swagger # $ go get -u github."><meta property="og:type" content="article"><meta property="og:url" content="https://shipengqi.github.io/golang-learn/docs/project/06_api_doc/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-12-10T13:28:06+08:00"><title>API 文档 | Go Learning</title><link rel=manifest href=/golang-learn/manifest.json><link rel=icon href=/golang-learn/favicon.png><link rel=stylesheet href=/golang-learn/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz+OQteg=" crossorigin=anonymous><script defer src=/golang-learn/flexsearch.min.js></script>
<script defer src=/golang-learn/en.search.min.615485de8d6610abd70ef04878dc149de209befa1eb24d891649b5d2d93d76c9.js integrity="sha256-YVSF3o1mEKvXDvBIeNwUneIJvvoesk2JFkm10tk9dsk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/golang-learn/><span>Go Learning</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://shipengqi.github.io/ target=_blank rel=noopener>Blog</a></li><li><a href=https://github.com/shipengqi/golang-learn target=_blank rel=noopener>Github</a></li></ul><ul><li><span>🍚 语言基础</span><ul><li><a href=/golang-learn/docs/basic/01_basic_type/>基础数据类型</a></li><li><a href=/golang-learn/docs/basic/02_array/>数组</a></li><li><a href=/golang-learn/docs/basic/03_slice/>切片</a></li><li><a href=/golang-learn/docs/basic/04_map/>哈希表</a></li><li><a href=/golang-learn/docs/basic/05_function/>函数</a></li><li><a href=/golang-learn/docs/basic/09_pointer/>指针</a></li></ul></li><li><a href=/golang-learn/docs/concurrency/>⚡ 并发编程</a><ul><li><a href=/golang-learn/docs/concurrency/01_mutex/>互斥锁</a></li><li><a href=/golang-learn/docs/concurrency/02_rwmutex/>读写锁</a></li><li><a href=/golang-learn/docs/concurrency/03_waitgroup/>WaitGroup</a></li><li><a href=/golang-learn/docs/concurrency/04_cond/>条件变量</a></li><li><a href=/golang-learn/docs/concurrency/05_once/>Once</a></li><li><a href=/golang-learn/docs/concurrency/06_pool/>Pool</a></li><li><a href=/golang-learn/docs/concurrency/07_context/>Context</a></li><li><a href=/golang-learn/docs/concurrency/08_atomic/>原子操作</a></li><li><a href=/golang-learn/docs/concurrency/09_channel/>Channel</a></li><li><a href=/golang-learn/docs/concurrency/10_sema/>信号量</a></li><li><a href=/golang-learn/docs/concurrency/11_singleflight/>SingleFlight</a></li><li><a href=/golang-learn/docs/concurrency/12_errorgroup/>ErrGroup</a></li></ul></li><li><span>🛠️ 实践</span><ul><li><a href=/golang-learn/docs/practice/01_build/>Go 编译</a></li><li><a href=/golang-learn/docs/practice/02_go_race/>Go 数据竞争检测器</a></li><li><a href=/golang-learn/docs/practice/04_pprof/>Go 性能分析（上）</a></li><li><a href=/golang-learn/docs/practice/05_trace/>Go 性能分析（下）</a></li><li><a href=/golang-learn/docs/practice/06_performance/>Go 性能优化</a></li><li><a href=/golang-learn/docs/practice/07_coredump/>Go Core Dump 调试</a></li><li><a href=/golang-learn/docs/practice/08_mod/>Go Modules</a></li><li><a href=/golang-learn/docs/practice/09_gin/>Gin 静态服务器</a></li><li><a href=/golang-learn/docs/practice/10_remote_dev/>Go 远程开发调试</a></li></ul></li><li><span>🛠️ Go 工程实践</span><ul><li><a href=/golang-learn/docs/project/01_specs/>项目规范</a></li><li><a href=/golang-learn/docs/project/02_structure/>项目的目录结构</a></li><li><a href=/golang-learn/docs/project/03_code/>代码规范</a></li><li><a href=/golang-learn/docs/project/04_commitizen/>Commit 规范</a></li><li><a href=/golang-learn/docs/project/05_version/>版本规范</a></li><li><a href=/golang-learn/docs/project/06_api_doc/ class=active>API 文档</a></li><li><a href=/golang-learn/docs/project/07_flow/>Git 工作流程</a></li><li><a href=/golang-learn/docs/project/08_make/>项目管理</a></li><li><a href=/golang-learn/docs/project/09_actions/>GitHub Actions</a></li><li><a href=/golang-learn/docs/project/10_dependabot/>GitHub Dependabot</a></li><li><a href=/golang-learn/docs/project/11_templates/>GitHub 模板</a></li><li><a href=/golang-learn/docs/project/12_goreleaser/>GoReleaser</a></li><li><a href=/golang-learn/docs/project/14_error/>错误处理</a></li><li><a href=/golang-learn/docs/project/16_casbin/>Casbin</a></li></ul></li><li><a href=/golang-learn/docs/advance/>🔍 底层原理</a><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/golang-learn/svg/menu.svg class=book-icon alt=Menu></label>
<strong>API 文档</strong>
<label for=toc-control><img src=/golang-learn/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#api-文档>API 文档</a><ul><li><a href=#使用-swagger-生成-api-文档>使用 Swagger 生成 API 文档</a></li><li><a href=#swagger-编辑器>Swagger 编辑器</a></li><li><a href=#基于代码自动生成-swagger-文档>基于代码自动生成 Swagger 文档</a><ul><li><a href=#安装-go-swagger>安装 go-swagger</a></li><li><a href=#使用>使用</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=api-文档>API 文档
<a class=anchor href=#api-%e6%96%87%e6%a1%a3>#</a></h1><h2 id=使用-swagger-生成-api-文档>使用 Swagger 生成 API 文档
<a class=anchor href=#%e4%bd%bf%e7%94%a8-swagger-%e7%94%9f%e6%88%90-api-%e6%96%87%e6%a1%a3>#</a></h2><p>Swagger 是基于 OpenAPI 规范的 API 文档工具。</p><blockquote><p>OpenAPI 是一个 API 规范，它的前身就是 Swagger 规范，目前最新的 OpenAPI
规范是 <a href=https://swagger.io/docs/specification/about/>OpenAPI 3.0</a>（也就是 Swagger 2.0 规范）。</p></blockquote><h2 id=swagger-编辑器>Swagger 编辑器
<a class=anchor href=#swagger-%e7%bc%96%e8%be%91%e5%99%a8>#</a></h2><p>Swagger 编辑是一个在线的 API 文档<a href=https://editor.swagger.io>编辑器</a>，可以在其中编写 OpenAPI 规范，并实时预览 API 文档。</p><h2 id=基于代码自动生成-swagger-文档>基于代码自动生成 Swagger 文档
<a class=anchor href=#%e5%9f%ba%e4%ba%8e%e4%bb%a3%e7%a0%81%e8%87%aa%e5%8a%a8%e7%94%9f%e6%88%90-swagger-%e6%96%87%e6%a1%a3>#</a></h2><p>Go 生成 Swagger 文档常用的工具有两个，分别是 <a href=https://github.com/swaggo/swag>swag</a> 和 <a href=https://github.com/go-swagger/go-swagger>go-swagger</a>。</p><p>推荐使用 go-swagger：</p><ol><li>go-swagger 提供了更灵活、更多的功能来描述 API，可以生成客户端和服务器端代码。</li><li>使用 swag 的话，每一个 API 都需要有一个冗长的注释，有时候代码注释比代码还要长，但是通过 go-swagger 可以将代码和注释分开编写，可以使代码保持简洁，清晰易读，而且可以把 API 定义放在一个目录中，方便管理。</li></ol><h3 id=安装-go-swagger>安装 go-swagger
<a class=anchor href=#%e5%ae%89%e8%a3%85-go-swagger>#</a></h3><pre tabindex=0><code>$ go get -u github.com/go-swagger/go-swagger/cmd/swagger
$ swagger version
version: v0.30.3
commit: ecf6f05b6ecc1b1725c8569534f133fa27e9de6b
</code></pre><p>命令格式为 <code>swagger [OPTIONS] &lt;command></code>。</p><p><code>swagger</code> 提供的子命令：</p><table><thead><tr><th>子命令</th><th>描述</th></tr></thead><tbody><tr><td>diff</td><td>对比两个 swagger 文档的差异</td></tr><tr><td>expand</td><td>展开 swagger 定义文档中的 $ref</td></tr><tr><td>flatten</td><td>展平 swagger 文档</td></tr><tr><td>generate</td><td>生成 swagger 文档，客户端，服务端代码</td></tr><tr><td>ini</td><td>初始化一个 swagger 定义文档</td></tr><tr><td>mix</td><td>合并 swagger 文档</td></tr><tr><td>serv</td><td>启动 http 服务，用来查看 swagger 文档</td></tr><tr><td>validate</td><td>验证 swagger 第一文件是否正确</td></tr></tbody></table><h3 id=使用>使用
<a class=anchor href=#%e4%bd%bf%e7%94%a8>#</a></h3><p>go-swagger 通过解析源码中的注释来生成 Swagger 文档。</p><p>注释语法：</p><table><thead><tr><th>注释语法</th><th>描述</th></tr></thead><tbody><tr><td>swagger:meta</td><td>定义全局基本信息</td></tr><tr><td>swagger:route</td><td>定义路由信息</td></tr><tr><td>swagger:parameters</td><td>API 请求参数</td></tr><tr><td>swagger:response</td><td>API 响应参数</td></tr><tr><td>swagger:model</td><td>可以复用的 Go 数据结构</td></tr><tr><td>swagger:allOf</td><td>嵌入其他 Go 结构体</td></tr><tr><td>swagger:strfmt</td><td>格式化的字符串</td></tr><tr><td>swagger:ignore</td><td>需要忽略的结构体</td></tr></tbody></table><p><code>swagger generate</code> 命令会找到 <code>main</code> 函数，然后遍历所有源码文件，解析源码中与 Swagger
相关的注释，然后自动生成 <code>swagger.json/swagger.yaml</code> 文件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/shipengqi/idm/swagger/api&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// This line is necessary for go-swagger to find your docs!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;github.com/shipengqi/idm/swagger/docs&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>users</span> []<span style=color:#f92672>*</span><span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Default</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>POST</span>(<span style=color:#e6db74>&#34;/users&#34;</span>, <span style=color:#a6e22e>Create</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>GET</span>(<span style=color:#e6db74>&#34;/users/:name&#34;</span>, <span style=color:#a6e22e>Get</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Run</span>(<span style=color:#e6db74>&#34;:8081&#34;</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create a user.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Create</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>user</span> <span style=color:#a6e22e>api</span>.<span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>ShouldBindJSON</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>user</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusBadRequest</span>, <span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>H</span>{<span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>(), <span style=color:#e6db74>&#34;code&#34;</span>: <span style=color:#ae81ff>10001</span>})
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>u</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>users</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>Name</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>Name</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusBadRequest</span>, <span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>H</span>{<span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;user %s already exist&#34;</span>, <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>Name</span>), <span style=color:#e6db74>&#34;code&#34;</span>: <span style=color:#ae81ff>10001</span>})
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>users</span> = append(<span style=color:#a6e22e>users</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>, <span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Get return user details.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Get</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>username</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Param</span>(<span style=color:#e6db74>&#34;name&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>u</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>users</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>Name</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>username</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>, <span style=color:#a6e22e>u</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusBadRequest</span>, <span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>H</span>{<span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;user %s not exist&#34;</span>, <span style=color:#a6e22e>username</span>), <span style=color:#e6db74>&#34;code&#34;</span>: <span style=color:#ae81ff>10002</span>})
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>swagger/api/user.go</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>api</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// User represents body of User request and response.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>User</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// User&#39;s name.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// Required: true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// User&#39;s nickname.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// Required: true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>Nickname</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;nickname&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// User&#39;s address.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>Address</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;address&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// User&#39;s email.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>Email</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;email&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>Required: true</code> 说明字段是必须的。</p><p>另外一个 Go 包中编写带 go-swagger 注释的 API 文档。 先创建一个目录 <code>swagger/docs</code>。在 <code>swagger/docs</code> 创建 <code>doc.go</code> 文件，提供基本的 API 信息：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Package docs awesome.
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Documentation of our awesome API.
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>//     Schemes: http, https
</span></span></span><span style=display:flex><span><span style=color:#75715e>//     BasePath: /
</span></span></span><span style=display:flex><span><span style=color:#75715e>//     Version: 0.1.0
</span></span></span><span style=display:flex><span><span style=color:#75715e>//     Host: some-url.com
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>//     Consumes:
</span></span></span><span style=display:flex><span><span style=color:#75715e>//     - application/json
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>//     Produces:
</span></span></span><span style=display:flex><span><span style=color:#75715e>//     - application/json
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>//     Security:
</span></span></span><span style=display:flex><span><span style=color:#75715e>//     - basic
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>//    SecurityDefinitions:
</span></span></span><span style=display:flex><span><span style=color:#75715e>//    basic:
</span></span></span><span style=display:flex><span><span style=color:#75715e>//      type: basic
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>// swagger:meta
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>package</span> <span style=color:#a6e22e>docs</span>
</span></span></code></pre></div><p>注意最后以 <code>swagger:meta</code> 注释结束。</p><p>编写完 <code>doc.go</code> 文件后， 编写 API 的定义文件 <code>swagger/docs/user.go</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>docs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>v1</span> <span style=color:#e6db74>&#34;github.com/shipengqi/idm/api/apiserver/v1&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>metav1</span> <span style=color:#e6db74>&#34;github.com/shipengqi/idm/api/meta/v1&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// swagger:route GET /users/{name} Users getUserRequest
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Get details for specified user.
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Get details for specified user according to input parameters.
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>//     Responses:
</span></span></span><span style=display:flex><span><span style=color:#75715e>//       default: errResponse
</span></span></span><span style=display:flex><span><span style=color:#75715e>//       200: getUserResponse
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// swagger:route GET /users Users listUserRequest
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>// List users.
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>// List users.
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>//     Responses:
</span></span></span><span style=display:flex><span><span style=color:#75715e>//       default: errResponse
</span></span></span><span style=display:flex><span><span style=color:#75715e>//       200: listUserResponse
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// List users request.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// swagger:parameters listUserRequest
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>listUserRequestParamsWrapper</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// in:query
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ListOptions</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// List users response.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// swagger:response listUserResponse
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>listUserResponseWrapper</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// in:body
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Body</span> <span style=color:#a6e22e>v1</span>.<span style=color:#a6e22e>UserList</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// User response.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// swagger:response getUserResponse
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>getUserResponseWrapper</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// in:body
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Body</span> <span style=color:#a6e22e>v1</span>.<span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// swagger:parameters createUserRequest updateUserRequest
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>userRequestParamsWrapper</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// User information.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// in:body
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Body</span> <span style=color:#a6e22e>v1</span>.<span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// swagger:parameters deleteUserRequest getUserRequest updateUserRequest
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>userNameParamsWrapper</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Username.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// in:path
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Name</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ErrResponse defines the return messages when an error occurred.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// swagger:response errResponse
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>errResponseWrapper</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// in:body
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>Body</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>Response</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Return nil json object.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// swagger:response okResponse
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>okResponseWrapper</span> <span style=color:#66d9ef>struct</span>{}
</span></span></code></pre></div><ul><li><code>swagger:route</code>：描述一个 API，格式为 <code>swagger:route [method] [url path pattern] [?tag1 tag2 tag3] [operation id]</code>，tag 可以是多个，相同 tag 的 API 在 Swagger 文档中会被分为一组。operation id 会和
<code>swagger:parameters</code> 的定义进行匹配，就是该 API 的请求参数。
<code>swagger:route</code> 下面的一行是该 API 的描述，需要以 <code>.</code> 为结尾。<code>responses:</code> 定义了 API 的返回参数，例如当 HTTP 状态码是 200 时，返回 <code>createUserResponse</code>，<code>createUserResponse</code> 会和 <code>swagger:response</code> 的定义进行匹配，匹配成功的 <code>swagger:response</code> 就是该 API 返回 200 状态码时的返回。</li><li><code>swagger:response</code>：定义了 API 的返回，格式为 <code>swagger:response [?response name]</code>.例如 <code>getUserResponseWrapper</code> 中有一个 <code>Body</code> 字段，其注释为 <code>// in:body</code>，说明该参数是在 HTTP Body 中返回。
<code>swagger:response</code> 上的注释是 response 的描述。<code>api.User</code> 会被 go-swagger 解析为 Example Value 和 Model，不需要重复编写。</li><li><code>swagger:parameters</code>：定义了 API 的请求参数，格式为 <code>swagger:parameters [operationid1 operationid2]</code>
。例如 <code>userRequestParamsWrapper</code>。<code>userRequestParamsWrapper</code> 上的注释是请求参数的描述。</li></ul><p>进入 <code>swagger</code> 目录，执行如下命令，生成 Swagger API 文档：</p><pre tabindex=0><code>$ swagger generate spec -o swagger.yaml
</code></pre><ul><li><code>-o</code>：指定要输出的文件名。swagger 会根据文件名后缀 <code>.yaml</code> 或者 <code>.json</code>，决定生成的文件格式为 YAML 或 JSON。</li></ul><p>启动 HTTP 服务：</p><pre tabindex=0><code>$ swagger serve --no-open -F=redoc --port 36666 swagger.yaml
</code></pre><ul><li><code>–no-open</code>：<code>-–no-open</code> 禁止调用浏览器打开 URL。</li><li><code>-F</code>：指定文档的风格，可选 <code>swagger</code> 和 <code>redoc</code>。<code>redoc</code> 格式更加易读和清晰。</li><li><code>–port</code>：指定启动的 HTTP 服务监听端口。</li></ul><p>在浏览器查看 API 文档：</p><p><img src=https://raw.githubusercontent.com/shipengqi/illustrations/0dad40be58e3b5959e8a9093a92ce49a9e280c6d/go/swagger-redoc.png alt=swagger-redoc></p><p>还可以使用下面的命令将生成的 <code>swagger.yaml</code> 转换为 <code>swagger.json</code>：</p><pre tabindex=0><code>$ swagger generate spec -i ./swagger.yaml -o ./swagger.json
</code></pre></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/shipengqi/golang-learn/commit/b048a599133a310223a8a95452d209a488e861e1 title='Last modified by shipengqi | December 10, 2024' target=_blank rel=noopener><img src=/golang-learn/svg/calendar.svg class=book-icon alt=Calendar>
<span>December 10, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/shipengqi/golang-learn/edit/master/content/docs/project/06_api_doc.md target=_blank rel=noopener><img src=/golang-learn/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#api-文档>API 文档</a><ul><li><a href=#使用-swagger-生成-api-文档>使用 Swagger 生成 API 文档</a></li><li><a href=#swagger-编辑器>Swagger 编辑器</a></li><li><a href=#基于代码自动生成-swagger-文档>基于代码自动生成 Swagger 文档</a><ul><li><a href=#安装-go-swagger>安装 go-swagger</a></li><li><a href=#使用>使用</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>