<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Casbin æ˜¯åŸºäº Go è¯­è¨€çš„å¼€æºæƒé™æ§åˆ¶åº“ã€‚æ”¯æŒ ACLï¼ŒRBACï¼ŒABAC ç­‰å¸¸ç”¨çš„è®¿é—®æ§åˆ¶æ¨¡å‹ã€‚
Casbin åªè´Ÿè´£è®¿é—®æ§åˆ¶ï¼Œä¸è´Ÿè´£éªŒè¯ç”¨æˆ·çš„ç”¨æˆ·åã€å¯†ç ï¼Œåº”è¯¥æœ‰ä¸“é—¨çš„ç»„ä»¶è´Ÿè´£èº«ä»½è®¤è¯ï¼Œå†é…åˆ Casbin è¿›è¡Œè®¿é—®æ§åˆ¶ã€‚ Casbin åªå­˜å‚¨ç”¨æˆ·å’Œè§’è‰²ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œä¸å­˜å‚¨ç”¨æˆ·ã€è§’è‰²ç­‰ä¿¡æ¯ã€‚ Casbin çš„è®¿é—®æ§åˆ¶æ¨¡å‹æ ¸å¿ƒå«åš PERMï¼ˆPolicyã€Effectã€Requestã€Matcherï¼‰ å…ƒæ¨¡å‹ã€‚
PERM å…ƒæ¨¡å‹ # PERMï¼ˆPolicyã€Effectã€Requestã€Matcherï¼‰å¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œå½“ä¸€ä¸ªè¯·æ±‚ï¼ˆRequestï¼‰è¿›æ¥ï¼Œéœ€è¦é€šè¿‡ç­–ç•¥åŒ¹é…å™¨ï¼ˆMatcherï¼‰å»åŒ¹é…å­˜å‚¨åœ¨æ•°æ®åº“ä¸­æˆ–è€… csv æ–‡ä»¶ä¸­çš„ç­–ç•¥è§„åˆ™ï¼Œæ‹¿åˆ°æ‰€æœ‰åŒ¹é…çš„ç­–ç•¥è§„åˆ™çš„ç»“æœï¼ˆeftï¼‰ä¹‹åï¼Œåœ¨ä½¿ç”¨ Effect å®šä¹‰ä¸­çš„è¡¨è¾¾å¼è¿›è¡Œè®¡ç®—ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ª true ï¼ˆé€šè¿‡ï¼‰æˆ– falseï¼ˆæ‹’ç»ï¼‰ã€‚
Request # Request ä»£è¡¨è¯·æ±‚ã€‚
è¯·æ±‚çš„å®šä¹‰ï¼Œè¿™ä¸ªå®šä¹‰çš„æ˜¯ e.Enforce(...) å‡½æ•°ä¸­çš„å‚æ•°ï¼š
[request_definition] r = sub, obj, act subï¼šä»£è¡¨è®¿é—®èµ„æºçš„å®ä½“ï¼Œä¸€èˆ¬å°±æ˜¯æŒ‡ç”¨æˆ·ã€‚ objï¼šè¦è®¿é—®çš„èµ„æºã€‚ actï¼šå¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œã€‚ è¿™é‡Œæ˜¯å®šä¹‰ä½ çš„è¯·æ±‚æ ¼å¼ã€‚å¦‚æœä½ ä¸éœ€è¦æŒ‡å®šèµ„æºï¼Œä½ å¯ä»¥å®šä¹‰ï¼š
[request_definition] r = sub, act æˆ–è€…å¦‚æœä½ æœ‰ä¸¤ä¸ªè®¿é—®å®ä½“ï¼Œä½ å¯ä»¥å®šä¹‰ï¼š
[request_definition] r = sub, sub2, obj, act Policy # Policy ä»£è¡¨ç­–ç•¥ã€‚
å®šä¹‰è®¿é—®ç­–ç•¥æ¨¡å‹ï¼Œè¿™ä¸ªå®šä¹‰çš„æ˜¯æ•°æ®åº“ä¸­æˆ–è€… csv æ–‡ä»¶ä¸­ç­–ç•¥è§„åˆ™çš„æ ¼å¼ï¼š
[policy_definition] p = sub, obj, act, eft p2 = sub, act eftï¼šè¡¨ç¤ºç­–ç•¥çš„ç»“æœï¼Œä¸€èˆ¬ä¸ºç©ºï¼Œé»˜è®¤æ˜¯ allowã€‚eft åªæ¥å—ä¸¤ä¸ªå€¼æ˜¯ allow æˆ– denyã€‚ ç­–ç•¥è§„åˆ™ï¼Œç­–ç•¥è§„åˆ™ä¸€èˆ¬å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨ csv æ–‡ä»¶ä¸­ï¼š"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:title" content="Casbin"><meta property="og:description" content="Casbin æ˜¯åŸºäº Go è¯­è¨€çš„å¼€æºæƒé™æ§åˆ¶åº“ã€‚æ”¯æŒ ACLï¼ŒRBACï¼ŒABAC ç­‰å¸¸ç”¨çš„è®¿é—®æ§åˆ¶æ¨¡å‹ã€‚
Casbin åªè´Ÿè´£è®¿é—®æ§åˆ¶ï¼Œä¸è´Ÿè´£éªŒè¯ç”¨æˆ·çš„ç”¨æˆ·åã€å¯†ç ï¼Œåº”è¯¥æœ‰ä¸“é—¨çš„ç»„ä»¶è´Ÿè´£èº«ä»½è®¤è¯ï¼Œå†é…åˆ Casbin è¿›è¡Œè®¿é—®æ§åˆ¶ã€‚ Casbin åªå­˜å‚¨ç”¨æˆ·å’Œè§’è‰²ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œä¸å­˜å‚¨ç”¨æˆ·ã€è§’è‰²ç­‰ä¿¡æ¯ã€‚ Casbin çš„è®¿é—®æ§åˆ¶æ¨¡å‹æ ¸å¿ƒå«åš PERMï¼ˆPolicyã€Effectã€Requestã€Matcherï¼‰ å…ƒæ¨¡å‹ã€‚
PERM å…ƒæ¨¡å‹ # PERMï¼ˆPolicyã€Effectã€Requestã€Matcherï¼‰å¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œå½“ä¸€ä¸ªè¯·æ±‚ï¼ˆRequestï¼‰è¿›æ¥ï¼Œéœ€è¦é€šè¿‡ç­–ç•¥åŒ¹é…å™¨ï¼ˆMatcherï¼‰å»åŒ¹é…å­˜å‚¨åœ¨æ•°æ®åº“ä¸­æˆ–è€… csv æ–‡ä»¶ä¸­çš„ç­–ç•¥è§„åˆ™ï¼Œæ‹¿åˆ°æ‰€æœ‰åŒ¹é…çš„ç­–ç•¥è§„åˆ™çš„ç»“æœï¼ˆeftï¼‰ä¹‹åï¼Œåœ¨ä½¿ç”¨ Effect å®šä¹‰ä¸­çš„è¡¨è¾¾å¼è¿›è¡Œè®¡ç®—ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ª true ï¼ˆé€šè¿‡ï¼‰æˆ– falseï¼ˆæ‹’ç»ï¼‰ã€‚
Request # Request ä»£è¡¨è¯·æ±‚ã€‚
è¯·æ±‚çš„å®šä¹‰ï¼Œè¿™ä¸ªå®šä¹‰çš„æ˜¯ e.Enforce(...) å‡½æ•°ä¸­çš„å‚æ•°ï¼š
[request_definition] r = sub, obj, act subï¼šä»£è¡¨è®¿é—®èµ„æºçš„å®ä½“ï¼Œä¸€èˆ¬å°±æ˜¯æŒ‡ç”¨æˆ·ã€‚ objï¼šè¦è®¿é—®çš„èµ„æºã€‚ actï¼šå¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œã€‚ è¿™é‡Œæ˜¯å®šä¹‰ä½ çš„è¯·æ±‚æ ¼å¼ã€‚å¦‚æœä½ ä¸éœ€è¦æŒ‡å®šèµ„æºï¼Œä½ å¯ä»¥å®šä¹‰ï¼š
[request_definition] r = sub, act æˆ–è€…å¦‚æœä½ æœ‰ä¸¤ä¸ªè®¿é—®å®ä½“ï¼Œä½ å¯ä»¥å®šä¹‰ï¼š
[request_definition] r = sub, sub2, obj, act Policy # Policy ä»£è¡¨ç­–ç•¥ã€‚
å®šä¹‰è®¿é—®ç­–ç•¥æ¨¡å‹ï¼Œè¿™ä¸ªå®šä¹‰çš„æ˜¯æ•°æ®åº“ä¸­æˆ–è€… csv æ–‡ä»¶ä¸­ç­–ç•¥è§„åˆ™çš„æ ¼å¼ï¼š
[policy_definition] p = sub, obj, act, eft p2 = sub, act eftï¼šè¡¨ç¤ºç­–ç•¥çš„ç»“æœï¼Œä¸€èˆ¬ä¸ºç©ºï¼Œé»˜è®¤æ˜¯ allowã€‚eft åªæ¥å—ä¸¤ä¸ªå€¼æ˜¯ allow æˆ– denyã€‚ ç­–ç•¥è§„åˆ™ï¼Œç­–ç•¥è§„åˆ™ä¸€èˆ¬å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨ csv æ–‡ä»¶ä¸­ï¼š"><meta property="og:type" content="article"><meta property="og:url" content="https://shipengqi.github.io/golang-learn/docs/project/16_casbin/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-12-13T11:07:35+08:00"><title>Casbin | Go Learning</title><link rel=manifest href=/golang-learn/manifest.json><link rel=icon href=/golang-learn/favicon.png><link rel=stylesheet href=/golang-learn/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz+OQteg=" crossorigin=anonymous><script defer src=/golang-learn/flexsearch.min.js></script>
<script defer src=/golang-learn/en.search.min.615485de8d6610abd70ef04878dc149de209befa1eb24d891649b5d2d93d76c9.js integrity="sha256-YVSF3o1mEKvXDvBIeNwUneIJvvoesk2JFkm10tk9dsk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/golang-learn/><span>Go Learning</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://shipengqi.github.io/ target=_blank rel=noopener>Blog</a></li><li><a href=https://github.com/shipengqi/golang-learn target=_blank rel=noopener>Github</a></li></ul><ul><li><span>ğŸš è¯­è¨€åŸºç¡€</span><ul><li><a href=/golang-learn/docs/basic/01_basic_type/>åŸºç¡€æ•°æ®ç±»å‹</a></li><li><a href=/golang-learn/docs/basic/02_array/>æ•°ç»„</a></li><li><a href=/golang-learn/docs/basic/03_slice/>åˆ‡ç‰‡</a></li><li><a href=/golang-learn/docs/basic/04_map/>å“ˆå¸Œè¡¨</a></li><li><a href=/golang-learn/docs/basic/05_function/>å‡½æ•°</a></li><li><a href=/golang-learn/docs/basic/09_pointer/>æŒ‡é’ˆ</a></li></ul></li><li><a href=/golang-learn/docs/concurrency/>âš¡ å¹¶å‘ç¼–ç¨‹</a><ul><li><a href=/golang-learn/docs/concurrency/01_mutex/>äº’æ–¥é”</a></li><li><a href=/golang-learn/docs/concurrency/02_rwmutex/>è¯»å†™é”</a></li><li><a href=/golang-learn/docs/concurrency/03_waitgroup/>WaitGroup</a></li><li><a href=/golang-learn/docs/concurrency/04_cond/>æ¡ä»¶å˜é‡</a></li><li><a href=/golang-learn/docs/concurrency/05_once/>Once</a></li><li><a href=/golang-learn/docs/concurrency/06_pool/>Pool</a></li><li><a href=/golang-learn/docs/concurrency/07_context/>Context</a></li><li><a href=/golang-learn/docs/concurrency/08_atomic/>åŸå­æ“ä½œ</a></li><li><a href=/golang-learn/docs/concurrency/09_channel/>Channel</a></li><li><a href=/golang-learn/docs/concurrency/10_sema/>ä¿¡å·é‡</a></li><li><a href=/golang-learn/docs/concurrency/11_singleflight/>SingleFlight</a></li><li><a href=/golang-learn/docs/concurrency/12_errorgroup/>ErrGroup</a></li></ul></li><li><span>ğŸ› ï¸ å®è·µ</span><ul><li><a href=/golang-learn/docs/practice/01_build/>Go ç¼–è¯‘</a></li><li><a href=/golang-learn/docs/practice/02_go_race/>Go æ•°æ®ç«äº‰æ£€æµ‹å™¨</a></li><li><a href=/golang-learn/docs/practice/04_pprof/>Go æ€§èƒ½åˆ†æï¼ˆä¸Šï¼‰</a></li><li><a href=/golang-learn/docs/practice/05_trace/>Go æ€§èƒ½åˆ†æï¼ˆä¸‹ï¼‰</a></li><li><a href=/golang-learn/docs/practice/06_performance/>Go æ€§èƒ½ä¼˜åŒ–</a></li><li><a href=/golang-learn/docs/practice/07_coredump/>Go Core Dump è°ƒè¯•</a></li><li><a href=/golang-learn/docs/practice/08_mod/>Go Modules</a></li><li><a href=/golang-learn/docs/practice/09_gin/>Gin é™æ€æœåŠ¡å™¨</a></li><li><a href=/golang-learn/docs/practice/10_remote_dev/>Go è¿œç¨‹å¼€å‘è°ƒè¯•</a></li></ul></li><li><span>ğŸ› ï¸ Go å·¥ç¨‹å®è·µ</span><ul><li><a href=/golang-learn/docs/project/01_specs/>é¡¹ç›®è§„èŒƒ</a></li><li><a href=/golang-learn/docs/project/02_structure/>é¡¹ç›®çš„ç›®å½•ç»“æ„</a></li><li><a href=/golang-learn/docs/project/03_code/>ä»£ç è§„èŒƒ</a></li><li><a href=/golang-learn/docs/project/04_commitizen/>Commit è§„èŒƒ</a></li><li><a href=/golang-learn/docs/project/05_version/>ç‰ˆæœ¬è§„èŒƒ</a></li><li><a href=/golang-learn/docs/project/06_api_doc/>API æ–‡æ¡£</a></li><li><a href=/golang-learn/docs/project/07_flow/>Git å·¥ä½œæµç¨‹</a></li><li><a href=/golang-learn/docs/project/08_make/>é¡¹ç›®ç®¡ç†</a></li><li><a href=/golang-learn/docs/project/09_actions/>GitHub Actions</a></li><li><a href=/golang-learn/docs/project/10_dependabot/>GitHub Dependabot</a></li><li><a href=/golang-learn/docs/project/11_templates/>GitHub æ¨¡æ¿</a></li><li><a href=/golang-learn/docs/project/12_goreleaser/>GoReleaser</a></li><li><a href=/golang-learn/docs/project/14_error/>é”™è¯¯å¤„ç†</a></li><li><a href=/golang-learn/docs/project/16_casbin/ class=active>Casbin</a></li></ul></li><li><a href=/golang-learn/docs/advance/>ğŸ” åº•å±‚åŸç†</a><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/golang-learn/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Casbin</strong>
<label for=toc-control><img src=/golang-learn/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#perm-å…ƒæ¨¡å‹>PERM å…ƒæ¨¡å‹</a><ul><li><a href=#request>Request</a></li><li><a href=#policy>Policy</a></li><li><a href=#matcher>Matcher</a></li><li><a href=#effect>Effect</a></li></ul></li><li><a href=#acl-model>ACL Model</a></li><li><a href=#rbac-model>RBAC Model</a><ul><li><a href=#è§’è‰²å±‚æ¬¡>è§’è‰²å±‚æ¬¡</a></li><li><a href=#åŒºåˆ†è§’è‰²å’Œç”¨æˆ·>åŒºåˆ†è§’è‰²å’Œç”¨æˆ·</a></li><li><a href=#æŸ¥è¯¢éšå¼è§’è‰²æˆ–æƒé™>æŸ¥è¯¢éšå¼è§’è‰²æˆ–æƒé™</a></li><li><a href=#èœå•æƒé™>èœå•æƒé™</a></li><li><a href=#èœå•æƒé™ç»§æ‰¿çš„ä¸¤ä¸ªé‡è¦è§„åˆ™>èœå•æƒé™ç»§æ‰¿çš„ä¸¤ä¸ªé‡è¦è§„åˆ™</a></li></ul></li><li><a href=#rbac-with-domains>RBAC with Domains</a></li><li><a href=#abac>ABAC</a><ul><li><a href=#ä½¿ç”¨-abac>ä½¿ç”¨ ABAC</a></li><li><a href=#abac-with-policy>ABAC with Policy</a></li></ul></li><li><a href=#super-admin>Super Admin</a></li><li><a href=#å‡½æ•°>å‡½æ•°</a><ul><li><a href=#keymatch>keyMatch</a></li><li><a href=#keymatch2>keyMatch2</a></li><li><a href=#è‡ªå®šä¹‰å‡½æ•°>è‡ªå®šä¹‰å‡½æ•°</a></li></ul></li><li><a href=#æ€§èƒ½ä¼˜åŒ–>æ€§èƒ½ä¼˜åŒ–</a><ul><li><a href=#ä¼˜åŒ–åŒ¹é…å™¨>ä¼˜åŒ–åŒ¹é…å™¨</a></li><li><a href=#å°½é‡å‡å°‘è§’è‰²ç»§æ‰¿å±‚çº§>å°½é‡å‡å°‘è§’è‰²ç»§æ‰¿å±‚çº§</a></li><li><a href=#åˆ†ç‰‡>åˆ†ç‰‡</a></li></ul></li></ul></nav></aside></header><article class=markdown><p><a href=https://github.com/casbin/casbin>Casbin</a> æ˜¯åŸºäº Go è¯­è¨€çš„å¼€æºæƒé™æ§åˆ¶åº“ã€‚æ”¯æŒ ACLï¼ŒRBACï¼ŒABAC ç­‰å¸¸ç”¨çš„è®¿é—®æ§åˆ¶æ¨¡å‹ã€‚</p><ul><li>Casbin <strong>åªè´Ÿè´£è®¿é—®æ§åˆ¶</strong>ï¼Œä¸è´Ÿè´£éªŒè¯ç”¨æˆ·çš„ç”¨æˆ·åã€å¯†ç ï¼Œåº”è¯¥æœ‰ä¸“é—¨çš„ç»„ä»¶è´Ÿè´£èº«ä»½è®¤è¯ï¼Œå†é…åˆ Casbin è¿›è¡Œè®¿é—®æ§åˆ¶ã€‚</li><li>Casbin <strong>åªå­˜å‚¨ç”¨æˆ·å’Œè§’è‰²ä¹‹é—´çš„æ˜ å°„å…³ç³»</strong>ï¼Œä¸å­˜å‚¨ç”¨æˆ·ã€è§’è‰²ç­‰ä¿¡æ¯ã€‚</li></ul><p>Casbin çš„è®¿é—®æ§åˆ¶æ¨¡å‹æ ¸å¿ƒå«åš PERMï¼ˆPolicyã€Effectã€Requestã€Matcherï¼‰ å…ƒæ¨¡å‹ã€‚</p><h1 id=perm-å…ƒæ¨¡å‹>PERM å…ƒæ¨¡å‹
<a class=anchor href=#perm-%e5%85%83%e6%a8%a1%e5%9e%8b>#</a></h1><p>PERMï¼ˆPolicyã€Effectã€Requestã€Matcherï¼‰å¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œå½“ä¸€ä¸ªè¯·æ±‚ï¼ˆRequestï¼‰è¿›æ¥ï¼Œéœ€è¦é€šè¿‡ç­–ç•¥åŒ¹é…å™¨ï¼ˆMatcherï¼‰å»åŒ¹é…å­˜å‚¨åœ¨æ•°æ®åº“ä¸­æˆ–è€…
csv æ–‡ä»¶ä¸­çš„ç­–ç•¥è§„åˆ™ï¼Œæ‹¿åˆ°æ‰€æœ‰åŒ¹é…çš„ç­–ç•¥è§„åˆ™çš„ç»“æœï¼ˆ<code>eft</code>ï¼‰ä¹‹åï¼Œåœ¨ä½¿ç”¨ <code>Effect</code> å®šä¹‰ä¸­çš„è¡¨è¾¾å¼è¿›è¡Œè®¡ç®—ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ª <code>true</code>
ï¼ˆé€šè¿‡ï¼‰æˆ– <code>false</code>ï¼ˆæ‹’ç»ï¼‰ã€‚</p><h2 id=request>Request
<a class=anchor href=#request>#</a></h2><p>Request ä»£è¡¨è¯·æ±‚ã€‚</p><p>è¯·æ±‚çš„å®šä¹‰ï¼Œè¿™ä¸ªå®šä¹‰çš„æ˜¯ <code>e.Enforce(...)</code> å‡½æ•°ä¸­çš„å‚æ•°ï¼š</p><pre tabindex=0><code>[request_definition]        
r = sub, obj, act
</code></pre><ul><li><code>sub</code>ï¼šä»£è¡¨è®¿é—®èµ„æºçš„å®ä½“ï¼Œä¸€èˆ¬å°±æ˜¯æŒ‡ç”¨æˆ·ã€‚</li><li><code>obj</code>ï¼šè¦è®¿é—®çš„èµ„æºã€‚</li><li><code>act</code>ï¼šå¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œã€‚</li></ul><p>è¿™é‡Œæ˜¯å®šä¹‰ä½ çš„è¯·æ±‚æ ¼å¼ã€‚å¦‚æœä½ ä¸éœ€è¦æŒ‡å®šèµ„æºï¼Œä½ å¯ä»¥å®šä¹‰ï¼š</p><pre tabindex=0><code>[request_definition]        
r = sub, act
</code></pre><p>æˆ–è€…å¦‚æœä½ æœ‰ä¸¤ä¸ªè®¿é—®å®ä½“ï¼Œä½ å¯ä»¥å®šä¹‰ï¼š</p><pre tabindex=0><code>[request_definition]        
r = sub, sub2, obj, act
</code></pre><h2 id=policy>Policy
<a class=anchor href=#policy>#</a></h2><p>Policy ä»£è¡¨ç­–ç•¥ã€‚</p><p><strong>å®šä¹‰è®¿é—®ç­–ç•¥æ¨¡å‹</strong>ï¼Œè¿™ä¸ªå®šä¹‰çš„æ˜¯æ•°æ®åº“ä¸­æˆ–è€… csv æ–‡ä»¶ä¸­ç­–ç•¥è§„åˆ™çš„æ ¼å¼ï¼š</p><pre tabindex=0><code>[policy_definition]
p = sub, obj, act, eft
p2 = sub, act
</code></pre><ul><li><code>eft</code>ï¼šè¡¨ç¤ºç­–ç•¥çš„ç»“æœï¼Œä¸€èˆ¬ä¸ºç©ºï¼Œé»˜è®¤æ˜¯ <code>allow</code>ã€‚<code>eft</code> <strong>åªæ¥å—ä¸¤ä¸ªå€¼æ˜¯ <code>allow</code> æˆ– <code>deny</code></strong>ã€‚</li></ul><p><strong>ç­–ç•¥è§„åˆ™</strong>ï¼Œç­–ç•¥è§„åˆ™ä¸€èˆ¬å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨ csv æ–‡ä»¶ä¸­ï¼š</p><pre tabindex=0><code>p, alice, data1, read
p2, bob, write-all-objects
</code></pre><p>ç­–ç•¥ä¸­çš„æ¯ä¸€è¡Œéƒ½è¢«ç§°ä¸º<strong>ç­–ç•¥è§„åˆ™</strong>ã€‚ æ¯ä¸ªç­–ç•¥è§„åˆ™éƒ½ä»¥ç­–ç•¥ç±»å‹ï¼ˆPolicy typeï¼‰å¼€å§‹ï¼Œå¦‚ <code>p</code> æˆ– <code>p2</code>ã€‚ç”¨äºåŒ¹é…ç­–ç•¥å®šä¹‰ä¸­çš„ <code>p</code>ã€
<code>p2</code>ã€‚åŒ¹é…å™¨ä¸­ä½¿ç”¨æ—¶ï¼š</p><pre tabindex=0><code>e = some(where (p2.eft == allow))
</code></pre><h2 id=matcher>Matcher
<a class=anchor href=#matcher>#</a></h2><p>Matcher ä»£è¡¨ç­–ç•¥åŒ¹é…å™¨ã€‚ç”¨æ¥éªŒè¯ä¸€ä¸ªè¯·æ±‚æ˜¯å¦åŒ¹é…æŸä¸ªç­–ç•¥è§„åˆ™ã€‚</p><p>å®šä¹‰åŒ¹é…è§„åˆ™ï¼š</p><pre tabindex=0><code>[matchers]
m = r.sub == p.sub &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act
</code></pre><p>ä¸Šé¢å®šä¹‰çš„åŒ¹é…è§„åˆ™è¡¨ç¤ºä¸€ä¸ªè¯·æ±‚å¦‚æœæ»¡è¶³ä¸‹é¢çš„ä¸‰ä¸ªæ¡ä»¶ï¼ŒåŒ¹é…å™¨å°±ä¼šè®¤ä¸ºåŒ¹é…åˆ°äº†è¯¥ç­–ç•¥è§„åˆ™ï¼Œå¹¶è¿”å›ç­–ç•¥ç»“æœ <code>p.eft</code>ï¼š</p><ul><li><code>r.sub == p.sub</code>ï¼šè¯·æ±‚çš„ <code>sub</code> å’Œç­–ç•¥çš„ <code>sub</code> ç›¸ç­‰</li><li><code>r.obj == p.obj</code>ï¼šè¯·æ±‚çš„ <code>obj</code> å’Œç­–ç•¥çš„ <code>obj</code> ç›¸ç­‰</li><li><code>r.act == p.act</code>ï¼šè¯·æ±‚çš„ <code>act</code> å’Œç­–ç•¥çš„ <code>act</code> ç›¸ç­‰</li></ul><blockquote><p>åŒ¹é…å™¨ä¸­å¯ä»¥ä½¿ç”¨ç®—æœ¯è¿ç®—ç¬¦å¦‚ <code>+</code>ã€<code>-</code>ã€<code>*</code>ã€<code>/</code> å’Œé€»è¾‘è¿ç®—ç¬¦å¦‚ <code>&&</code>ã€<code>||</code>ã€<code>!</code>ã€‚</p></blockquote><h2 id=effect>Effect
<a class=anchor href=#effect>#</a></h2><p>Effect ä»£è¡¨ç­–ç•¥æ•ˆæœã€‚å®ƒå¯ä»¥è¢«ç†è§£ä¸ºä¸€ç§æ¨¡å‹ï¼Œåœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œå¯¹åŒ¹é…ç»“æœå†æ¬¡ä½œå‡ºé€»è¾‘ç»„åˆåˆ¤æ–­ã€‚</p><p>ä¾‹å¦‚ä¸€ä¸ªè¯·æ±‚åŒ¹é…åˆ°äº†ä¸¤æ¡ç­–ç•¥è§„åˆ™ï¼Œä¸€æ¡è§„åˆ™å…è®¸ï¼Œå¦ä¸€æ¡è§„åˆ™æ‹’ç»ã€‚</p><p>ç­–ç•¥æ•ˆæœçš„å®šä¹‰ä¸ºï¼š</p><pre tabindex=0><code>[policy_effect]
e = some(where (p.eft == allow))
</code></pre><p>è¿™æ„å‘³ç€ï¼Œå¦‚æœåŒ¹é…çš„ç­–ç•¥è§„åˆ™æœ‰ä¸€æ¡çš„ç­–ç•¥ç»“æœä¸º <code>allow</code>ï¼Œé‚£ä¹ˆæœ€ç»ˆç»“æœä¸º <code>allow</code>ã€‚</p><p>ç­–ç•¥æ•ˆæœçš„å¦ä¸€ä¸ªä¾‹å­ï¼š</p><pre tabindex=0><code>[policy_effect]
e = !some(where (p.eft == deny))
</code></pre><p>è¿™æ„å‘³ç€ï¼Œå¦‚æœåŒ¹é…çš„ç­–ç•¥è§„åˆ™æœ‰ä¸€æ¡çš„ç­–ç•¥ç»“æœä¸º <code>deny</code>ï¼Œé‚£ä¹ˆæœ€ç»ˆç»“æœä¸º <code>deny</code>ã€‚å¦åˆ™å°±æ˜¯ <code>allow</code>ã€‚</p><p>ç­–ç•¥æ•ˆæœç”šè‡³å¯ä»¥ç”¨é€»è¾‘è¡¨è¾¾å¼è¿æ¥ï¼š</p><pre tabindex=0><code>[policy_effect]
e = some(where (p.eft == allow)) &amp;&amp; !some(where (p.eft == deny))
</code></pre><p>è¿™æ„å‘³ç€å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªåŒ¹é…çš„ <code>allow</code> ç­–ç•¥è§„åˆ™ï¼Œå¹¶ä¸”ä¸èƒ½æœ‰ä»»ä½•åŒ¹é…çš„ <code>deny</code> ç­–ç•¥è§„åˆ™ã€‚</p><p>ç›®å‰ Casbin <strong>åªæ”¯æŒä¸‹é¢çš„å†…ç½®ç­–ç•¥æ•ˆæœ</strong>ï¼š</p><ul><li><code>some(where (p.eft == allow))</code></li><li><code>!some(where (p.eft == deny))</code></li><li><code>some(where (p.eft == allow)) && !some(where (p.eft == deny))</code></li><li><code>priority(p.eft) || deny</code></li><li><code>subjectPriority(p.eft)</code></li></ul><h1 id=acl-model>ACL Model
<a class=anchor href=#acl-model>#</a></h1><p>Casbin æä¾›äº†ä¸€ä¸ªåœ¨çº¿çš„<a href=https://casbin.org/editor/>ç¼–è¾‘å™¨</a>ï¼Œå¯ä»¥ç”¨æ¥éªŒè¯ä½ çš„ PERM æ¨¡å‹å’Œç­–ç•¥è§„åˆ™ã€‚</p><p>ä¸€ä¸ªç®€å•çš„ ACL Modelï¼š</p><pre tabindex=0><code>[request_definition]
r = sub, obj, act

[policy_definition]
p = sub, obj, act

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = r.sub == p.sub &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act
</code></pre><p>ç­–ç•¥è§„åˆ™ï¼ˆPolicyï¼‰ï¼š</p><pre tabindex=0><code>p, alice, data1, read
p, bob, data2, write
p, bob, data1, write, deny
</code></pre><p>è¯·æ±‚ï¼ˆRequestï¼‰ï¼š</p><pre tabindex=0><code>alice, data1, read
</code></pre><p>ä¸Šé¢çš„è¯·æ±‚ï¼Œå¯ä»¥åŒ¹é…åˆ°ç­–ç•¥ <code>p, alice, data1, read</code>ï¼Œå¹¶ä¸”é»˜è®¤çš„ <code>eft</code> æ˜¯ <code>allow</code>ï¼Œç»è¿‡ Effect è¡¨è¾¾å¼
<code>some(where (p.eft == allow))</code>ï¼Œå¾—åˆ°æ‰§è¡Œç»“æœï¼š</p><pre tabindex=0><code>true Reason: [alice, data1, read]
</code></pre><p>æ¥ç€ä¿®æ”¹è¯·æ±‚ï¼š</p><pre tabindex=0><code>alice, data1, write
bob, data1, read
</code></pre><p>ä¸Šé¢çš„ä¸¤ä¸ªè¯·æ±‚å¾—åˆ°æ‰§è¡Œç»“æœï¼š</p><pre tabindex=0><code>false
false
</code></pre><p>ä¿®æ”¹è¯·æ±‚ï¼š</p><pre tabindex=0><code>bob, data1, write
</code></pre><p>ä¼šåŒ¹é…åˆ°ç­–ç•¥ <code>p, bob, data1, write</code> å¾—åˆ°ç»“æœ <code>deny</code>ï¼Œæ‰€ä»¥æ‰§è¡Œç»“æœæ˜¯ <code>false</code>ã€‚</p><p>å¦‚æœç­–ç•¥ä¸­æœ‰ä¸¤æ¡ç›¸åŒçš„ç­–ç•¥ï¼Œä½†æ˜¯ <code>eft</code> ä¸åŒï¼Œä¾‹å¦‚ï¼š</p><pre tabindex=0><code>p, bob, data1, write, allow
p, bob, data1, write, deny
</code></pre><p>è¯·æ±‚ <code>bob, data1, write</code> å¾—åˆ°çš„æ‰§è¡Œç»“æœæ˜¯ <code>true Reason: [bob, data1, write]</code>ï¼Œå› ä¸º Effect çš„è¡¨è¾¾å¼åªè¦æœ‰ä¸€æ¡ <code>allow</code> å°±è¿”å›
<code>true</code>ã€‚</p><p>å¦‚æœæƒ³è¦å®ƒä¸é€šè¿‡å°±ä¿®æ”¹ Effect ä¸ºï¼š</p><pre tabindex=0><code>[policy_effect]
some(where (p.eft == allow)) &amp;&amp; !some(where (p.eft == deny))
</code></pre><p>è¡¨ç¤ºå¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªåŒ¹é…çš„ <code>allow</code> ç­–ç•¥è§„åˆ™ï¼Œå¹¶ä¸”ä¸èƒ½æœ‰ä»»ä½•åŒ¹é…çš„ <code>deny</code> ç­–ç•¥è§„åˆ™ã€‚</p><h1 id=rbac-model>RBAC Model
<a class=anchor href=#rbac-model>#</a></h1><p>RBAC æœ‰ä¸€ä¸ªæ–°çš„æ¦‚å¿µè§’è‰²åŸŸ <code>role_definition</code>ï¼Œ<code>[role_definition]</code> ç”¨äºè¡¨ç¤º <code>sub</code> ä¸è§’è‰²çš„å…³ç³»ï¼Œè§’è‰²çš„ç»§æ‰¿å…³ç³»ã€‚</p><pre tabindex=0><code>[request_definition]
r = sub, obj, act

[policy_definition]
p = sub, obj, act

[role_definition]
g = _, _

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = g(r.sub, p.sub) &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act
</code></pre><ul><li><code>g = _, _</code> ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•° <code>_</code> è¡¨ç¤º<strong>ç”¨æˆ·</strong>ï¼Œç¬¬äºŒä¸ª <code>_</code> è¡¨ç¤º<strong>è§’è‰²</strong>ã€‚</li><li><code>g(r.sub, p.sub)</code> è¡¨ç¤ºè¯·æ±‚ä¸­çš„ <code>sub</code> æ˜¯å¦ä¸ç­–ç•¥è§„åˆ™ä¸­çš„ï¼ˆ<code>p.sub</code>ï¼‰å­˜åœ¨è§’è‰²å…³ç³»ã€‚</li></ul><blockquote><p><code>g</code> å‡½æ•°ï¼šæ˜¯ Casbin ä¸­ç”¨äºæ£€æŸ¥è§’è‰²å…³ç³»çš„å‡½æ•°ã€‚ä¾‹å¦‚ alice æ˜¯ adminï¼Œç­–ç•¥è§„åˆ™ä¸­å®šä¹‰äº† <code>p.sub = admin</code>ï¼Œé‚£ä¹ˆ
<code>g(alice, admin)</code> è¿”å› <code>true</code>ã€‚</p></blockquote><p>ç­–ç•¥æ–‡ä»¶ï¼š</p><pre tabindex=0><code>// è§’è‰² admin å¯ä»¥å¯¹ data1 èµ„æºæ‰§è¡Œ read å’Œ write æ“ä½œ
p, admin, data1, read
p, admin, data1, write
// è§’è‰² user å¯ä»¥å¯¹ data2 èµ„æºæ‰§è¡Œ read æ“ä½œ
p, user, data2, read

// alice è¢«åˆ†é…ä¸º admin è§’è‰²ï¼Œbob è¢«åˆ†é…ä¸º user è§’è‰²ã€‚
g, alice, admin
g, bob, user
</code></pre><p>è¯·æ±‚ï¼š</p><pre tabindex=0><code>alice, data1, write
bob, data1, read
</code></pre><p>ä¸Šé¢çš„ä¸¤ä¸ªè¯·æ±‚å¾—åˆ°æ‰§è¡Œç»“æœï¼š</p><pre tabindex=0><code>true Reason: [admin, data1, write]
false
</code></pre><ul><li>alice æ˜¯ admin è§’è‰²ï¼Œå¯ä»¥å¯¹ data1 èµ„æºæ‰§è¡Œ read å’Œ write æ“ä½œï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªè¯·æ±‚ç»“æœä¸º <code>true</code>ã€‚</li><li>bob æ˜¯ user è§’è‰²ï¼Œåªæœ‰ data2 èµ„æºçš„ read æƒé™ï¼Œæ²¡æœ‰ data1 çš„ä»»ä½•æƒé™ï¼Œæ‰€ä»¥è¯·æ±‚ç»“æœä¸º <code>false</code>ã€‚</li></ul><blockquote><p>è¯·æ±‚ <code>alice, data1, write</code> ç»è¿‡ <code>g(alice, admin)</code> å¤„ç†ï¼Œç”¨æˆ· alice å’Œè§’è‰² admin éƒ½ä¼šç”¨æ¥å»åŒ¹é…ç­–ç•¥è§„åˆ™ä¸­çš„ <code>sub</code>ã€‚</p></blockquote><h2 id=è§’è‰²å±‚æ¬¡>è§’è‰²å±‚æ¬¡
<a class=anchor href=#%e8%a7%92%e8%89%b2%e5%b1%82%e6%ac%a1>#</a></h2><p>Casbin çš„ RBAC æ”¯æŒ RBAC1 çš„è§’è‰²å±‚æ¬¡ç»“æ„ç‰¹æ€§ï¼Œè¿™æ„å‘³ç€å¦‚æœ alice ç”¨æœ‰è§’è‰² role1ï¼Œå¹¶ä¸”è§’è‰² role1 æ‹¥æœ‰è§’è‰² role2ï¼Œé‚£ä¹ˆ alice
ä¹Ÿå°†æ‹¥æœ‰ role2 çš„æ‰€æœ‰æƒé™ã€‚</p><p>Casbin ä¸­çš„å†…ç½®è§’è‰²ç®¡ç†å™¨ï¼Œå¯ä»¥æŒ‡å®š<strong>æœ€å¤§å±‚æ¬¡çº§åˆ«</strong>ã€‚é»˜è®¤å€¼æ˜¯ <code>10</code>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// NewRoleManager is the constructor for creating an instance of the
</span></span></span><span style=display:flex><span><span style=color:#75715e>// default RoleManager implementation.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewRoleManager</span>(<span style=color:#a6e22e>maxHierarchyLevel</span> <span style=color:#66d9ef>int</span>) <span style=color:#a6e22e>rbac</span>.<span style=color:#a6e22e>RoleManager</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>rm</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>RoleManager</span>{}
</span></span><span style=display:flex><span><span style=color:#a6e22e>rm</span>.<span style=color:#a6e22e>allRoles</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>Map</span>{}
</span></span><span style=display:flex><span><span style=color:#a6e22e>rm</span>.<span style=color:#a6e22e>maxHierarchyLevel</span> = <span style=color:#a6e22e>maxHierarchyLevel</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>rm</span>.<span style=color:#a6e22e>hasPattern</span> = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>rm</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=åŒºåˆ†è§’è‰²å’Œç”¨æˆ·>åŒºåˆ†è§’è‰²å’Œç”¨æˆ·
<a class=anchor href=#%e5%8c%ba%e5%88%86%e8%a7%92%e8%89%b2%e5%92%8c%e7%94%a8%e6%88%b7>#</a></h2><p>åœ¨ RBAC ç³»ç»Ÿå†…<strong>ç”¨æˆ·å’Œè§’è‰²ä¸èƒ½ä½¿ç”¨ç›¸åŒçš„åç§°</strong>ï¼Œå› ä¸ºå¯¹äº Casbin æ¥è¯´ï¼Œä¸ç®¡æ˜¯ç”¨æˆ·è¿˜æ˜¯è§’è‰²éƒ½åªæ˜¯ä¸€ä¸ª<strong>å­—ç¬¦ä¸²</strong>ï¼ŒCasbin
æ˜¯æ²¡æœ‰åŠæ³•çŸ¥é“ä½ æŒ‡å®šçš„æ˜¯ç”¨æˆ· alice è¿˜æ˜¯è§’è‰² aliceã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨å‰ç¼€æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚ <code>role::alice</code> è¡¨ç¤ºè§’è‰² aliceã€‚</p><h2 id=æŸ¥è¯¢éšå¼è§’è‰²æˆ–æƒé™>æŸ¥è¯¢éšå¼è§’è‰²æˆ–æƒé™
<a class=anchor href=#%e6%9f%a5%e8%af%a2%e9%9a%90%e5%bc%8f%e8%a7%92%e8%89%b2%e6%88%96%e6%9d%83%e9%99%90>#</a></h2><p>å½“ç”¨æˆ·é€šè¿‡ RBAC å±‚æ¬¡ç»“æ„ç»§æ‰¿è§’è‰²æˆ–æƒé™ï¼Œè€Œä¸æ˜¯åœ¨ç­–ç•¥è§„åˆ™ä¸­ç›´æ¥åˆ†é…å®ƒä»¬æ—¶ï¼Œè¿™ç§ç±»å‹çš„åˆ†é…ä¸º<strong>éšå¼</strong>ã€‚ è¦æŸ¥è¯¢æ­¤ç±»éšå¼å…³ç³»ï¼Œéœ€è¦ä½¿ç”¨è¿™ä¸¤ä¸ª
APIï¼š<code>GetImplicitRolesForUser()</code> å’Œ <code>GetImplicitPermissionsForUser()</code>ï¼Œè€Œä¸æ˜¯ <code>GetRolesForUser()</code> å’Œ
<code>GetPermissionsForUser()</code>ã€‚</p><h2 id=èœå•æƒé™>èœå•æƒé™
<a class=anchor href=#%e8%8f%9c%e5%8d%95%e6%9d%83%e9%99%90>#</a></h2><p>RBAC é€šå¸¸åªéœ€è¦ç”¨æˆ·çš„è§’è‰²ï¼Œåªä½¿ç”¨ <code>g</code> å°±å¯ä»¥äº†ã€‚ä½†æ˜¯å½“ä½ éœ€è¦ä¸ºèµ„æºå®šä¹‰ç»§æ‰¿å…³ç³»æ—¶ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨ <code>g</code> å’Œ <code>g2</code>ï¼Œä¸‹é¢çš„ä¾‹å­æ˜¯å®šä¹‰èœå•æƒé™çš„æ¨¡å‹ï¼š</p><pre tabindex=0><code>[request_definition]
r = sub, obj, act

[policy_definition]
p = sub, obj, act, eft

[role_definition]
g = _, _
g2 = _, _

[policy_effect]
e = some(where (p_eft == allow)) &amp;&amp; !some(where (p_eft == deny))

[matchers]
m = g(r.sub, p.sub) &amp;&amp; r.act == p.act &amp;&amp; (g2(r.obj, p.obj) || r.obj == p.obj)
</code></pre><p><code>g2</code> æ˜¯ä¸ºäº†å®šä¹‰èœå•é¡¹çš„å±‚æ¬¡ç»“æ„ã€‚</p><p>ç­–ç•¥è§„åˆ™ï¼š</p><pre tabindex=0><code>p, ROLE_ROOT, SystemMenu, read, allow
p, ROLE_ROOT, AdminMenu, read, allow
p, ROLE_ROOT, UserMenu, read, deny
p, ROLE_ADMIN, UserMenu, read, allow
p, ROLE_ADMIN, AdminMenu, read, allow
p, ROLE_ADMIN, AdminSubMenu_deny, read, deny
p, ROLE_USER, UserSubMenu_allow, read, allow

g, user, ROLE_USER
g, admin, ROLE_ADMIN
g, root, ROLE_ROOT
g, ROLE_ADMIN, ROLE_USER

g2, UserSubMenu_allow, UserMenu
g2, UserSubMenu_deny, UserMenu
g2, UserSubSubMenu, UserSubMenu_allow
g2, AdminSubMenu_allow, AdminMenu
g2, AdminSubMenu_deny, AdminMenu
g2, (NULL), SystemMenu
</code></pre><ul><li><code>g2, UserSubMenu_allow, UserMenu</code> è¡¨ç¤º <code>UserSubMenu_allow</code> æ˜¯ <code>UserMenu</code> çš„å­èœå•ã€‚</li><li><code>g2, (NULL), SystemMenu</code> è¡¨ç¤º <code>SystemMenu</code> æ²¡æœ‰å­èœå•é¡¹ï¼Œæ„å‘³ç€å®ƒæ˜¯é¡¶çº§èœå•é¡¹ã€‚</li></ul><table><thead><tr><th>èœå•åç§°</th><th>ROLE_ROOT</th><th>ROLE_ADMIN</th><th>ROLE_USER</th></tr></thead><tbody><tr><td>SystemMenu</td><td>âœ…</td><td>âŒ</td><td>âŒ</td></tr><tr><td>UserMenu</td><td>âŒ</td><td>âœ…</td><td>âŒ</td></tr><tr><td>UserSubMenu_allow</td><td>âŒ</td><td>âœ…</td><td>âœ…</td></tr><tr><td>UserSubSubMenu</td><td>âŒ</td><td>âœ…</td><td>âœ…</td></tr><tr><td>UserSubMenu_deny</td><td>âŒ</td><td>âœ…</td><td>âŒ</td></tr><tr><td>AdminMenu</td><td>âœ…</td><td>âœ…</td><td>âŒ</td></tr><tr><td>AdminSubMenu_allow</td><td>âœ…</td><td>âœ…</td><td>âŒ</td></tr><tr><td>AdminSubMenu_deny</td><td>âœ…</td><td>âŒ</td><td>âŒ</td></tr></tbody></table><h2 id=èœå•æƒé™ç»§æ‰¿çš„ä¸¤ä¸ªé‡è¦è§„åˆ™>èœå•æƒé™ç»§æ‰¿çš„ä¸¤ä¸ªé‡è¦è§„åˆ™
<a class=anchor href=#%e8%8f%9c%e5%8d%95%e6%9d%83%e9%99%90%e7%bb%a7%e6%89%bf%e7%9a%84%e4%b8%a4%e4%b8%aa%e9%87%8d%e8%a6%81%e8%a7%84%e5%88%99>#</a></h2><p><strong>çˆ¶èœå•æƒé™çš„ç»§æ‰¿</strong>ï¼š</p><p>å¦‚æœä¸€ä¸ªçˆ¶èœå•æ˜ç¡®åœ°è¢«æˆäºˆ <code>allow</code> æƒé™ï¼Œé‚£ä¹ˆå®ƒçš„æ‰€æœ‰å­èœå•ä¹Ÿé»˜è®¤ä¸º <code>allow</code> æƒé™ï¼Œé™¤éç‰¹åˆ«æ ‡è®°ä¸º <code>deny</code>
ã€‚è¿™æ„å‘³ç€ä¸€æ—¦ä¸€ä¸ªçˆ¶èœå•æ˜¯å¯è®¿é—®çš„ï¼Œå®ƒçš„å­èœå•é»˜è®¤ä¹Ÿæ˜¯å¯è®¿é—®çš„ã€‚</p><p><strong>æ²¡æœ‰ç›´æ¥è®¾ç½®æƒé™çš„çˆ¶èœå•</strong>ï¼š</p><p>å¦‚æœä¸€ä¸ªçˆ¶èœå•æ²¡æœ‰ç›´æ¥è®¾ç½®æƒé™ï¼ˆæ—¢æ²¡æœ‰æ˜ç¡®å…è®¸ä¹Ÿæ²¡æœ‰æ˜ç¡®æ‹’ç»ï¼‰ï¼Œä½†<strong>å¦‚æœæœ‰ä¸€ä¸ªå­èœå•æ˜ç¡®è¢«æˆäºˆ <code>allow</code> æƒé™ï¼Œé‚£ä¹ˆçˆ¶èœå•è¢«éšå¼åœ°è®¤ä¸ºå…·æœ‰ <code>allow</code> æƒé™</strong>ã€‚è¿™<strong>ç¡®ä¿äº†ç”¨æˆ·å¯ä»¥å¯¼èˆªåˆ°è¿™äº›å­èœå•</strong>ã€‚</p><h1 id=rbac-with-domains>RBAC with Domains
<a class=anchor href=#rbac-with-domains>#</a></h1><p>Casbin ä¸­çš„ RBAC æ˜¯å¯ä»¥æ”¯æŒå¤šç§Ÿæˆ·çš„ã€‚</p><p>å¤šç§Ÿæˆ·çš„ Model å®šä¹‰ï¼š</p><pre tabindex=0><code>[request_definition]
// è¿™é‡Œçš„ dom å‚æ•°å°±è¡¨ç¤ºåŸŸ/ç§Ÿæˆ·ã€‚
r = sub, dom, obj, act

[policy_definition]
// è¿™é‡Œçš„ dom å‚æ•°å°±è¡¨ç¤ºåŸŸ/ç§Ÿæˆ·ã€‚
p = sub, dom, obj, act

[role_definition]
// è¿™é‡Œçš„ä½†ä¸‰ä¸ªå‚æ•° `_` å°±è¡¨ç¤ºåŸŸ/ç§Ÿæˆ·ã€‚
g = _, _, _

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = g(r.sub, p.sub, r.dom) &amp;&amp; r.dom == p.dom &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act
</code></pre><p>å¯¹åº”çš„ç­–ç•¥è§„åˆ™æ˜¯ï¼š</p><pre tabindex=0><code>// åŸŸ dom/ç§Ÿæˆ· åœ¨ç¬¬äºŒä¸ªå‚æ•°çš„ä½ç½®
p, admin, tenant1, data1, read
p, admin, tenant2, data2, read

g, alice, admin, tenant1
g, alice, user, tenant2
</code></pre><ul><li>tenant1 ä¸­çš„ admin è§’è‰²å¯ä»¥è¯»å– data1ã€‚</li><li>alice åœ¨ tenant1 ä¸­æ‹¥æœ‰ admin è§’è‰²ï¼Œåœ¨ tenant2 ä¸­æ‹¥æœ‰ user è§’è‰²ã€‚</li></ul><p>è¯·æ±‚ <code>alice, tenant1, data1, read</code> çš„æ‰§è¡Œç»“æœä¸º <code>true Reason: [admin, tenant1, data1, read]</code>ï¼Œå› ä¸º alice åœ¨ tenant1 ä¸­æ‹¥æœ‰
admin è§’è‰²ã€‚</p><p>è¯·æ±‚ <code>alice, tenant2, data2, read</code> çš„æ‰§è¡Œç»“æœä¸º <code>false</code>ï¼Œå› ä¸º alice åœ¨ tenant2 ä¸­ä¸æ˜¯ adminï¼Œæ‰€ä»¥å¥¹æ— æ³•è¯»å– data2ã€‚</p><p>åŒ¹é…å™¨ï¼š</p><pre tabindex=0><code>[matchers]
m = g(r.sub, p.sub, r.dom) &amp;&amp; r.dom == p.dom &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act
</code></pre><ul><li><code>g(r.sub, p.sub, r.dom)</code>ï¼šéªŒè¯è¯·æ±‚ä¸­çš„ <code>r.sub</code> æ˜¯å¦ä¸ç­–ç•¥è§„åˆ™ä¸­çš„ <code>p.sub</code> åœ¨ç‰¹å®šåŸŸï¼ˆ<code>r.dom</code>ï¼‰ä¸­å­˜åœ¨è§’è‰²å…³ç³»ã€‚</li><li><code>r.dom == p.dom</code>ï¼šç¡®ä¿è¯·æ±‚ä¸­çš„åŸŸï¼ˆ<code>r.dom</code>ï¼‰ä¸ç­–ç•¥è§„åˆ™ä¸­çš„åŸŸï¼ˆ<code>p.dom</code>ï¼‰ä¸€è‡´ã€‚åœ¨ RBAC with domains æ¨¡å‹ä¸­ï¼Œ*
<em>ä¸åŒçš„åŸŸå¯èƒ½æœ‰ç›¸åŒçš„è§’è‰²æˆ–ç”¨æˆ·ï¼Œéœ€è¦æ˜ç¡®åŒºåˆ†æ‰€å±åŸŸ</em>*ã€‚</li></ul><h1 id=abac>ABAC
<a class=anchor href=#abac>#</a></h1><p>ABAC (Attribute-Based Access Control) æ¨¡å‹ï¼Œæ˜¯åŸºäºå¦‚ç”¨æˆ·ã€èµ„æºã€ç¯å¢ƒç­‰å±æ€§æ¥æ§åˆ¶æƒé™ã€‚</p><p><strong>ABAC æ¨¡å‹æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š</p><ul><li><strong>å±æ€§</strong>ï¼ˆAttributesï¼‰ï¼šæè¿°è¯·æ±‚ä¸»ä½“ï¼ˆç”¨æˆ·ï¼‰ã€å¯¹è±¡ï¼ˆèµ„æºï¼‰å’Œç¯å¢ƒçš„ç›¸å…³ä¿¡æ¯ã€‚<ul><li><strong>ç”¨æˆ·å±æ€§</strong>ï¼šå¦‚ç”¨æˆ·åã€å¹´é¾„ã€éƒ¨é—¨ã€è§’è‰²ç­‰ã€‚</li><li><strong>èµ„æºå±æ€§</strong>ï¼šå¦‚èµ„æºç±»å‹ã€æ ‡ç­¾ã€åˆ›å»ºè€…ç­‰ã€‚</li><li><strong>ç¯å¢ƒå±æ€§</strong>ï¼šå¦‚æ—¶é—´ã€åœ°ç‚¹ã€è®¾å¤‡ç±»å‹ç­‰ã€‚</li></ul></li></ul><p>å®˜æ–¹çš„ ABAC ç¤ºä¾‹ï¼š</p><pre tabindex=0><code>[request_definition]
r = sub, obj, act

[policy_definition]
p = sub, obj, act

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = r.sub == r.obj.Owner
</code></pre><p>åœ¨åŒ¹é…å™¨ä¸­ï¼Œä½¿ç”¨ <code>r.obj.Owner</code> ä»£æ›¿ <code>r.obj</code>ã€‚ä¼ é€’ç»™ <code>Enforce()</code> å‡½æ•°çš„ <code>r.obj</code> å°†æ˜¯ä¸€ä¸ªç»“æ„ä½“æˆ–ç±»å®ä¾‹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚
Casbin å°†ä½¿ç”¨åå°„æ¥æ£€ç´¢è¯¥ç»“æ„ä½“æˆ–ç±»ä¸­çš„ <code>obj</code> æˆå‘˜å˜é‡ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>testResource</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span><span style=color:#a6e22e>Name</span>  <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Owner</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>e</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewEnforcer</span>(<span style=color:#e6db74>&#34;examples/abac_model.conf&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>EnableAcceptJsonRequest</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>data1</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>testResource</span>{<span style=color:#a6e22e>Name</span>: <span style=color:#e6db74>&#34;data1&#34;</span>, <span style=color:#a6e22e>Owner</span>: <span style=color:#e6db74>&#34;bob&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ok</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Enforce</span>(<span style=color:#e6db74>&#34;alice&#34;</span>, <span style=color:#a6e22e>data1</span>, <span style=color:#e6db74>&#34;read&#34;</span>)
</span></span></code></pre></div><p>å¯ä»¥ä½¿ç”¨ <code>e.EnableAcceptJsonRequest(true)</code> å¯ç”¨å‘ <code>enforcer</code> ä¼ é€’ JSON å‚æ•°çš„åŠŸèƒ½ã€‚ä½†æ˜¯æ³¨æ„<strong>å¯ç”¨æ¥å— JSON å‚æ•°çš„åŠŸèƒ½å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™
1.1 åˆ° 1.5 å€</strong>ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>e</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewEnforcer</span>(<span style=color:#e6db74>&#34;examples/abac_model.conf&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>EnableAcceptJsonRequest</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>data1Json</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>`{ &#34;Name&#34;: &#34;data1&#34;, &#34;Owner&#34;: &#34;bob&#34;}`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ok</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Enforce</span>(<span style=color:#e6db74>&#34;alice&#34;</span>, <span style=color:#a6e22e>data1Json</span>, <span style=color:#e6db74>&#34;read&#34;</span>)
</span></span></code></pre></div><h2 id=ä½¿ç”¨-abac>ä½¿ç”¨ ABAC
<a class=anchor href=#%e4%bd%bf%e7%94%a8-abac>#</a></h2><p>è¦ä½¿ç”¨ ABACï¼Œéœ€è¦åšä¸¤ä»¶äº‹ï¼š</p><ul><li>åœ¨æ¨¡å‹åŒ¹é…å™¨ä¸­æŒ‡å®šå±æ€§ã€‚</li><li>å°†ç»“æ„ä½“æˆ–ç±»å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>Enforce()</code> å‡½æ•°ã€‚</li></ul><blockquote><p><strong>åªæœ‰è¯·æ±‚å…ƒç´ æ”¯æŒ ABACï¼ˆ<code>r.sub</code>ã€<code>r.obj</code>ã€<code>r.act</code> ç­‰ï¼‰</strong>ï¼Œ<code>p.sub</code> è¿™æ ·çš„ç­–ç•¥å…ƒç´ æ˜¯ä¸æ”¯æŒçš„ï¼Œå› ä¸ºåœ¨ç­–ç•¥è§„åˆ™ä¸­æ²¡æœ‰åŠæ³•å®šä¹‰ä¸€ä¸ªç»“æ„ä½“æˆ–ç±»ï¼Œåªæ”¯æŒå­—ç¬¦ä¸²ã€‚</p></blockquote><h2 id=abac-with-policy>ABAC with Policy
<a class=anchor href=#abac-with-policy>#</a></h2><p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæˆæƒç³»ç»Ÿéœ€è¦å¤æ‚å’Œå¤§é‡çš„ ABAC è§„åˆ™ï¼Œæ‰€ä»¥ä¸Šé¢ä¿®æ”¹åŒ¹é…å™¨çš„æ–¹å¼æ˜¯æ»¡è¶³ä¸äº†éœ€æ±‚çš„ã€‚</p><p>Casbin æä¾›äº† <code>eval()</code> å‡½æ•°ï¼Œç”¨äºåŠ¨æ€æ‰§è¡Œå­—ç¬¦ä¸²å½¢å¼çš„è¡¨è¾¾å¼ã€‚è¿™ä¸ªå‡½æ•°å¯ä»¥å®ç°åœ¨ç­–ç•¥ä¸­æ·»åŠ è§„åˆ™ï¼Œè€Œä¸æ˜¯åœ¨æ¨¡å‹ä¸­ã€‚</p><pre tabindex=0><code>[request_definition]
r = sub, obj, act

[policy_definition]
p = sub_rule, obj, act

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = eval(p.sub_rule) &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act
</code></pre><p>ç­–ç•¥è§„åˆ™ï¼š</p><pre tabindex=0><code>p, r.sub.Age &gt; 18, /data1, read
p, r.sub.Age &lt; 60, /data2, write
</code></pre><p>è¯·æ±‚ <code>{Age: 30}, /data1, read</code> çš„æ‰§è¡Œç»“æœä¸º <code>true Reason [r.sub.Age > 18, /data1, read]</code>ã€‚ å› ä¸ºåŒ¹é…å™¨é€šè¿‡
<code>eval(p.sub_rule)</code> æ‰§è¡Œç­–ç•¥ä¸­çš„æ¡ä»¶é€»è¾‘ <code>r.sub.Age > 18</code>ã€‚</p><h1 id=super-admin>Super Admin
<a class=anchor href=#super-admin>#</a></h1><p>è¶…çº§ç®¡ç†å‘˜æ˜¯æ•´ä¸ªç³»ç»Ÿçš„ç®¡ç†å‘˜ã€‚å¯ä»¥ç”¨äº RBACã€ABAC ç­‰æ¨¡å‹ä¸­ã€‚</p><pre tabindex=0><code>[request_definition]
r = sub, obj, act

[policy_definition]
p = sub, obj, act

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = r.sub == p.sub &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act || r.sub == &#34;root&#34;
</code></pre><p><code>r.sub == "root"</code> æ£€æŸ¥ <code>sub</code> æ˜¯å¦ä¸º <code>root</code>ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å› <code>allow</code>ã€‚</p><h1 id=å‡½æ•°>å‡½æ•°
<a class=anchor href=#%e5%87%bd%e6%95%b0>#</a></h1><p>Casbin æä¾›äº†ä¸€ç³»åˆ—å†…ç½®å‡½æ•°ï¼Œç”¨äº<strong>æ‰©å±•å’Œç®€åŒ–åŒ¹é…å™¨çš„é€»è¾‘å¤„ç†</strong>ã€‚è¿™äº›å‡½æ•°å¯ä»¥æ”¯æŒå­—ç¬¦ä¸²åŒ¹é…ã€è·¯å¾„åŒ¹é…ã€æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç­‰åŠŸèƒ½ã€‚</p><p><code>keyMatch/keyMatch2/keyMatch3/keyMatch4/keyMatch5</code> éƒ½æ˜¯åŒ¹é… URL è·¯å¾„çš„ï¼Œ<code>regexMatch</code> ä½¿ç”¨æ­£åˆ™åŒ¹é…ï¼Œ`ipMatch åŒ¹é… IP åœ°å€ã€‚å‚è§ <a href=https://casbin.org/zh/docs/function/>Functions</a>ã€‚</p><h2 id=keymatch>keyMatch
<a class=anchor href=#keymatch>#</a></h2><p>ç”¨äºå­—ç¬¦ä¸²é€šé…ç¬¦åŒ¹é…ï¼Œ<code>*</code> è¡¨ç¤ºé€šé…ã€‚å½“éœ€è¦å¯¹è·¯å¾„è§„åˆ™è¿›è¡Œé€šé…æ—¶ä½¿ç”¨ï¼Œä¾‹å¦‚ <code>/data/*</code> å¯ä»¥åŒ¹é… <code>/data/1</code> å’Œ <code>/data/2</code>ã€‚</p><pre tabindex=0><code>m = g(r.sub, p.sub) &amp;&amp; keyMatch(r.obj, p.obj) &amp;&amp; r.act == p.act
</code></pre><p>ç­–ç•¥æ–‡ä»¶ï¼š</p><pre tabindex=0><code>p, alice, /data/*, read
</code></pre><p>è¯·æ±‚æ ¡éªŒï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Enforce</span>(<span style=color:#e6db74>&#34;alice&#34;</span>, <span style=color:#e6db74>&#34;/data/123&#34;</span>, <span style=color:#e6db74>&#34;read&#34;</span>)  <span style=color:#75715e>// è¿”å› True
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Enforce</span>(<span style=color:#e6db74>&#34;alice&#34;</span>, <span style=color:#e6db74>&#34;/data&#34;</span>, <span style=color:#e6db74>&#34;read&#34;</span>)     <span style=color:#75715e>// è¿”å› False
</span></span></span></code></pre></div><h2 id=keymatch2>keyMatch2
<a class=anchor href=#keymatch2>#</a></h2><p>æ”¯æŒæ›´å¤æ‚çš„è·¯å¾„åŒ¹é…è§„åˆ™ï¼Œ<code>:parameter</code> è¡¨ç¤ºè·¯å¾„å˜é‡ã€‚å½“éœ€è¦åŒ¹é… RESTful é£æ ¼çš„ URL æ—¶ä½¿ç”¨ï¼Œä¾‹å¦‚ <code>/data/:id</code> å¯ä»¥åŒ¹é… <code>/data/1</code>ã€‚</p><pre tabindex=0><code>m = g(r.sub, p.sub) &amp;&amp; keyMatch2(r.obj, p.obj) &amp;&amp; r.act == p.act
</code></pre><p>ç­–ç•¥æ–‡ä»¶ï¼š</p><pre tabindex=0><code>p, alice, /data/:id, read
</code></pre><p>è¯·æ±‚æ ¡éªŒï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Enforce</span>(<span style=color:#e6db74>&#34;alice&#34;</span>, <span style=color:#e6db74>&#34;/data/123&#34;</span>, <span style=color:#e6db74>&#34;read&#34;</span>)  <span style=color:#75715e>// è¿”å› True
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Enforce</span>(<span style=color:#e6db74>&#34;alice&#34;</span>, <span style=color:#e6db74>&#34;/data/abc&#34;</span>, <span style=color:#e6db74>&#34;read&#34;</span>) <span style=color:#75715e>// è¿”å› True
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Enforce</span>(<span style=color:#e6db74>&#34;alice&#34;</span>, <span style=color:#e6db74>&#34;/data/&#34;</span>, <span style=color:#e6db74>&#34;read&#34;</span>)    <span style=color:#75715e>// è¿”å› False
</span></span></span></code></pre></div><h2 id=è‡ªå®šä¹‰å‡½æ•°>è‡ªå®šä¹‰å‡½æ•°
<a class=anchor href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%87%bd%e6%95%b0>#</a></h2><p>ä¾‹å¦‚å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œåˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯åå‘ï¼ˆå›æ–‡ï¼‰å…³ç³»ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;errors&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è‡ªå®šä¹‰å‡½æ•°ï¼šåˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºåå‘å­—ç¬¦ä¸²
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ReverseMatch</span>(<span style=color:#a6e22e>args</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>interface</span>{}) (<span style=color:#66d9ef>interface</span>{}, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>args</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>2</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;ReverseMatch requires exactly 2 arguments&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>str1</span>, <span style=color:#a6e22e>ok1</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>0</span>].(<span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>str2</span>, <span style=color:#a6e22e>ok2</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>1</span>].(<span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok1</span> <span style=color:#f92672>||</span> !<span style=color:#a6e22e>ok2</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;arguments must be strings&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// åˆ¤æ–­ str1 æ˜¯å¦ä¸º str2 çš„åå‘
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>str1</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>ReverseString</span>(<span style=color:#a6e22e>str2</span>), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è¾…åŠ©å‡½æ•°ï¼šåè½¬å­—ç¬¦ä¸²
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ReverseString</span>(<span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>runes</span> <span style=color:#f92672>:=</span> []rune(<span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>j</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>, len(<span style=color:#a6e22e>runes</span>)<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>j</span>; <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>j</span> = <span style=color:#a6e22e>i</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>j</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>runes</span>[<span style=color:#a6e22e>i</span>], <span style=color:#a6e22e>runes</span>[<span style=color:#a6e22e>j</span>] = <span style=color:#a6e22e>runes</span>[<span style=color:#a6e22e>j</span>], <span style=color:#a6e22e>runes</span>[<span style=color:#a6e22e>i</span>]
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> string(<span style=color:#a6e22e>runes</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>é€šè¿‡ <code>e.AddFunction</code> å°†è‡ªå®šä¹‰å‡½æ•°æ³¨å†Œåˆ° Casbin çš„æ¨¡å‹ä¸­ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;github.com/casbin/casbin/v2&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// åŠ è½½æ¨¡å‹å’Œç­–ç•¥
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>e</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>casbin</span>.<span style=color:#a6e22e>NewEnforcer</span>(<span style=color:#e6db74>&#34;model.conf&#34;</span>, <span style=color:#e6db74>&#34;policy.csv&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// æ³¨å†Œè‡ªå®šä¹‰å‡½æ•°
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>AddFunction</span>(<span style=color:#e6db74>&#34;ReverseMatch&#34;</span>, <span style=color:#a6e22e>ReverseMatch</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// æµ‹è¯•æƒé™æ ¡éªŒ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>testCases</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>sub</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>obj</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>act</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	}{
</span></span><span style=display:flex><span>		{<span style=color:#e6db74>&#34;alice&#34;</span>, <span style=color:#e6db74>&#34;ecila&#34;</span>, <span style=color:#e6db74>&#34;read&#34;</span>}, <span style=color:#75715e>// åŒ¹é…åå‘å­—ç¬¦ä¸²
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		{<span style=color:#e6db74>&#34;bob&#34;</span>, <span style=color:#e6db74>&#34;bob&#34;</span>, <span style=color:#e6db74>&#34;read&#34;</span>},    <span style=color:#75715e>// ä¸åŒ¹é…
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>tc</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>testCases</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Enforce</span>(<span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>sub</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>obj</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>act</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Enforce(%s, %s, %s) = %v\n&#34;</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>sub</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>obj</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>act</span>, <span style=color:#a6e22e>result</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>åœ¨æ¨¡å‹ä¸­ä½¿ç”¨å‡½æ•°ï¼š</p><pre tabindex=0><code>[matchers]
m = r.sub == p.sub &amp;&amp; ReverseMatch(r.obj, p.obj) &amp;&amp; r.act == p.act
</code></pre><h1 id=æ€§èƒ½ä¼˜åŒ–>æ€§èƒ½ä¼˜åŒ–
<a class=anchor href=#%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96>#</a></h1><h2 id=ä¼˜åŒ–åŒ¹é…å™¨>ä¼˜åŒ–åŒ¹é…å™¨
<a class=anchor href=#%e4%bc%98%e5%8c%96%e5%8c%b9%e9%85%8d%e5%99%a8>#</a></h2><p>åŒ¹é…å™¨æ˜¯ Casbin æƒé™æ£€æŸ¥çš„æ ¸å¿ƒï¼Œä¼˜åŒ–åŒ¹é…å™¨å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚</p><p><strong>é€šè¿‡åˆå¹¶æˆ–ç®€åŒ–æ¡ä»¶å‡å°‘è®¡ç®—å¼€é”€</strong>ï¼š</p><pre tabindex=0><code>// ä¼˜åŒ–å‰
m = g(r.sub, p.sub) &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act &amp;&amp; r.dom == p.dom

// ä¼˜åŒ–å
// å°†å¤šä¸ªæ¡ä»¶åˆå¹¶ä¸ºå­—ç¬¦ä¸²æ¯”è¾ƒ
m = g(r.sub, p.sub) &amp;&amp; r.dom == p.dom &amp;&amp; r.obj + &#34;:&#34; + r.act == p.obj + &#34;:&#34; + p.act
</code></pre><ul><li>å­—ç¬¦ä¸²æ‹¼æ¥çš„è®¡ç®—æˆæœ¬é€šå¸¸ä½äºå¤šæ¬¡é€»è¾‘æ¯”è¾ƒã€‚</li><li>åˆå¹¶ååŒ¹é…å™¨è®¡ç®—æ¬¡æ•°å‡å°‘ã€‚</li></ul><p>å¦‚æœåŒ¹é…å™¨çš„æ¡ä»¶å¤šä¸”é¡ºåºä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¿…è¦çš„è®¡ç®—ã€‚<strong>å°†åŒ¹é…æ¦‚ç‡è¾ƒé«˜çš„æ¡ä»¶æ”¾åœ¨å‰é¢</strong>ï¼š</p><pre tabindex=0><code># ä¼˜åŒ–å‰
m = r.obj == p.obj &amp;&amp; g(r.sub, p.sub) &amp;&amp; r.act == p.act

# ä¼˜åŒ–åï¼ˆæ›´é«˜æ¦‚ç‡æ¡ä»¶åœ¨å‰ï¼‰
m = g(r.sub, p.sub) &amp;&amp; r.obj == p.obj &amp;&amp; r.act == p.act
</code></pre><h2 id=å°½é‡å‡å°‘è§’è‰²ç»§æ‰¿å±‚çº§>å°½é‡å‡å°‘è§’è‰²ç»§æ‰¿å±‚çº§
<a class=anchor href=#%e5%b0%bd%e9%87%8f%e5%87%8f%e5%b0%91%e8%a7%92%e8%89%b2%e7%bb%a7%e6%89%bf%e5%b1%82%e7%ba%a7>#</a></h2><p>è§’è‰²ç»§æ‰¿å…³ç³»ä¼šå½±å“åŒ¹é…å™¨çš„æ•ˆç‡ã€‚æ·±åº¦è¿‡å¤§çš„ç»§æ‰¿é“¾ä¼šå¢åŠ è®¡ç®—æˆæœ¬ã€‚</p><h2 id=åˆ†ç‰‡>åˆ†ç‰‡
<a class=anchor href=#%e5%88%86%e7%89%87>#</a></h2><p>è¿›è¡Œåˆ†ç‰‡ï¼Œè®© Casbin æ‰§è¡Œå™¨åªåŠ è½½ä¸€å°éƒ¨åˆ†ç­–ç•¥è§„åˆ™ã€‚ä¾‹å¦‚ï¼Œ<code>æ‰§è¡Œå™¨_0</code> å¯ä»¥æœåŠ¡äº <code>ç§Ÿæˆ·_0</code> åˆ° <code>ç§Ÿæˆ·_99</code>ï¼Œè€Œ <code>æ‰§è¡Œå™¨_1</code> å¯ä»¥æœåŠ¡äº <code>ç§Ÿæˆ·_100</code> åˆ° <code>ç§Ÿæˆ·_199</code>ã€‚</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/shipengqi/golang-learn/commit/3d4d1f1274943c25b463c56e53c009de955e8b37 title='Last modified by shipengqi | December 13, 2024' target=_blank rel=noopener><img src=/golang-learn/svg/calendar.svg class=book-icon alt=Calendar>
<span>December 13, 2024</span></a></div><div><a class="flex align-center" href=https://github.com/shipengqi/golang-learn/edit/master/content/docs/project/16_casbin.md target=_blank rel=noopener><img src=/golang-learn/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#perm-å…ƒæ¨¡å‹>PERM å…ƒæ¨¡å‹</a><ul><li><a href=#request>Request</a></li><li><a href=#policy>Policy</a></li><li><a href=#matcher>Matcher</a></li><li><a href=#effect>Effect</a></li></ul></li><li><a href=#acl-model>ACL Model</a></li><li><a href=#rbac-model>RBAC Model</a><ul><li><a href=#è§’è‰²å±‚æ¬¡>è§’è‰²å±‚æ¬¡</a></li><li><a href=#åŒºåˆ†è§’è‰²å’Œç”¨æˆ·>åŒºåˆ†è§’è‰²å’Œç”¨æˆ·</a></li><li><a href=#æŸ¥è¯¢éšå¼è§’è‰²æˆ–æƒé™>æŸ¥è¯¢éšå¼è§’è‰²æˆ–æƒé™</a></li><li><a href=#èœå•æƒé™>èœå•æƒé™</a></li><li><a href=#èœå•æƒé™ç»§æ‰¿çš„ä¸¤ä¸ªé‡è¦è§„åˆ™>èœå•æƒé™ç»§æ‰¿çš„ä¸¤ä¸ªé‡è¦è§„åˆ™</a></li></ul></li><li><a href=#rbac-with-domains>RBAC with Domains</a></li><li><a href=#abac>ABAC</a><ul><li><a href=#ä½¿ç”¨-abac>ä½¿ç”¨ ABAC</a></li><li><a href=#abac-with-policy>ABAC with Policy</a></li></ul></li><li><a href=#super-admin>Super Admin</a></li><li><a href=#å‡½æ•°>å‡½æ•°</a><ul><li><a href=#keymatch>keyMatch</a></li><li><a href=#keymatch2>keyMatch2</a></li><li><a href=#è‡ªå®šä¹‰å‡½æ•°>è‡ªå®šä¹‰å‡½æ•°</a></li></ul></li><li><a href=#æ€§èƒ½ä¼˜åŒ–>æ€§èƒ½ä¼˜åŒ–</a><ul><li><a href=#ä¼˜åŒ–åŒ¹é…å™¨>ä¼˜åŒ–åŒ¹é…å™¨</a></li><li><a href=#å°½é‡å‡å°‘è§’è‰²ç»§æ‰¿å±‚çº§>å°½é‡å‡å°‘è§’è‰²ç»§æ‰¿å±‚çº§</a></li><li><a href=#åˆ†ç‰‡>åˆ†ç‰‡</a></li></ul></li></ul></nav></div></aside></main></body></html>