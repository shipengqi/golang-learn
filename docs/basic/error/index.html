<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="错误#error 类型#error 类型是内置的接口类型。error 类型可能是 nil 或者 non-nil，nil 表示成功。
错误处理#当函数调用返回错误时，最常用的处理方式是传播错误，如。
resp, err := http.Get(url) if err != nil{ // 将这个HTTP错误返回给调用者 return nil, err } doc, err := html.Parse(resp.Body) resp.Body.Close() if err != nil { // fmt.Errorf函数使用fmt.Sprintf格式化错误信息并返回 // 使用该函数前缀添加额外的上下文信息到原始错误信息。 return nil, fmt.Errorf(&#34;parsing %s as HTML: %v&#34;, url,err) } 由于错误信息经常是以链式组合在一起的，所以错误信息中应避免大写和换行符。
编写错误信息时，我们要确保错误信息对问题细节的描述是详尽的。尤其是要注意错误信息表达的一致性，即相同的函数或同包内 的同一组函数返回的错误在构成和处理方式上是相似的。
根据不同的场景，我们可能要对错误做些特殊处理，比如错误重试机制，或者打印错误日志，或者直接忽略错误。
文件结尾错误#io 包在任何由文件结束引起的读取失败都返回同一个错误 io.EOF：
in := bufio.NewReader(os.Stdin) for { r, _, err := in.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="错误" />
<meta property="og:description" content="错误#error 类型#error 类型是内置的接口类型。error 类型可能是 nil 或者 non-nil，nil 表示成功。
错误处理#当函数调用返回错误时，最常用的处理方式是传播错误，如。
resp, err := http.Get(url) if err != nil{ // 将这个HTTP错误返回给调用者 return nil, err } doc, err := html.Parse(resp.Body) resp.Body.Close() if err != nil { // fmt.Errorf函数使用fmt.Sprintf格式化错误信息并返回 // 使用该函数前缀添加额外的上下文信息到原始错误信息。 return nil, fmt.Errorf(&#34;parsing %s as HTML: %v&#34;, url,err) } 由于错误信息经常是以链式组合在一起的，所以错误信息中应避免大写和换行符。
编写错误信息时，我们要确保错误信息对问题细节的描述是详尽的。尤其是要注意错误信息表达的一致性，即相同的函数或同包内 的同一组函数返回的错误在构成和处理方式上是相似的。
根据不同的场景，我们可能要对错误做些特殊处理，比如错误重试机制，或者打印错误日志，或者直接忽略错误。
文件结尾错误#io 包在任何由文件结束引起的读取失败都返回同一个错误 io.EOF：
in := bufio.NewReader(os.Stdin) for { r, _, err := in." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://shipengqi.github.io/golang-learn/docs/basic/error/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2023-10-07T14:03:42+08:00" />
<title>错误 | Golang Learning</title>
<link rel="manifest" href="/golang-learn/manifest.json">
<link rel="icon" href="/golang-learn/favicon.png" >
<link rel="stylesheet" href="/golang-learn/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css" integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz&#43;OQteg=" crossorigin="anonymous">
  <script defer src="/golang-learn/flexsearch.min.js"></script>
  <script defer src="/golang-learn/en.search.min.9d19f3cf24b235d59b85d5a7e5dcdc41758b1caac59546ce7f048de6fd1ce8fd.js" integrity="sha256-nRnzzySyNdWbhdWn5dzcQXWLHKrFlUbOfwSN5v0c6P0=" crossorigin="anonymous"></script>

  <script defer src="/golang-learn/sw.min.e9a55528e030e44ecbe1b5a8da7dd8fb40bd282d02dc4574e81b999a6a21bc84.js" integrity="sha256-6aVVKOAw5E7L4bWo2n3Y&#43;0C9KC0C3EV06BuZmmohvIQ=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/golang-learn/"><span>Golang Learning</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>







  
<ul>
  
  <li>
    <a href="https://github.com/shipengqi/golang-learn"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://shipengqi.github.io/"  target="_blank" rel="noopener">
        Blog
      </a>
  </li>
  
</ul>







  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>语言基础</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/env_config/" class="">Go 环境配置</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/build/" class="">Golang 条件编译</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/map/" class="">map</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/slice/" class="">slice</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/scope/" class="">作用域</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/function/" class="">函数</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/package/" class="">包</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/reflect/" class="">反射</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/var/" class="">变量</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/basic_data/" class="">基础据类型</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/constant/" class="">常量</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/json/" class="">序列化</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/pointer/" class="">指针</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/interface/" class="">接口</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/flow/" class="">控制语句</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/array/" class="">数组</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/test/" class="">测试</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/struct/" class="">结构体</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/operator/" class="">运算符</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/error/" class="active">错误</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/basic/oop/" class="">面向对象</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>并发编程</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/concurrent/channel/" class="">channel</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/concurrent/goroutine/" class="">goroutine</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/concurrent/sync_lock/" class="">同步和锁</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/concurrent/concurrent/" class="">并发和并行</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>常用命令</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/build/" class="">build</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/doc/" class="">doc</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/env/" class="">env</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/fmt/" class="">fmt</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/get/" class="">get</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/summary/" class="">Go 命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/golint/" class="">golint</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/install/" class="">install</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/mod/" class="">mod</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/run/" class="">run</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/test/" class="">test</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/tool/" class="">tool</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/commands/vet/" class="">vet</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>常用标准库</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <span>Data</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/data/big/" class="">big</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/data/container/" class="">container</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/data/math/" class="">math</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/data/sort/" class="">sort</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Database</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/database/sql/" class="">sql</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Io</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/io/bufio/" class="">bufio</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/io/fmt/" class="">fmt 包</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/io/io/" class="">io</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/io/ioutil/" class="">ioutil</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Net</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/net/http/" class="">http</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Os</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/os/filepath/" class="">filepath</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/os/os/" class="">os</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Text</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/text/strconv/" class="">strconv</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/text/strings/" class="">strings</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/text/unicode/" class="">unicode</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/unsafe/" class="">Unsafe</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/log/" class="">log</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/standards/time/" class="">time</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>实践</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/errors/" class="">Errors</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/gin/" class="">Gin</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/ginkgo/" class="">Ginkgo</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/pprof/" class="">Go PProf</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/trace/" class="">Go trace</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/go-race/" class="">Go 数据竞争检测器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/go_relative_path/" class="">Go 的相对路径</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/practice/json/" class="">Json Unmarshal</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>底层原理</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/advance/scheduler/" class="">Goroutine 调度器</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/advance/mm/" class="">内存分配</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/golang-learn/docs/advance/gc/" class="">垃圾回收</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/golang-learn/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>错误</strong>

  <label for="toc-control">
    
    <img src="/golang-learn/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#错误">错误</a>
      <ul>
        <li><a href="#error-类型">error 类型</a>
          <ul>
            <li><a href="#错误处理">错误处理</a></li>
            <li><a href="#文件结尾错误">文件结尾错误</a></li>
          </ul>
        </li>
        <li><a href="#panic-异常">Panic 异常</a>
          <ul>
            <li><a href="#panic-函数">panic 函数</a></li>
            <li><a href="#panic-详情中都有什么">panic 详情中都有什么</a></li>
            <li><a href="#从-panic-被引发到程序终止运行的大致过程是什么">从 panic 被引发到程序终止运行的大致过程是什么</a></li>
            <li><a href="#怎样让-panic-包含一个值以及应该让它包含什么样的值">怎样让 panic 包含一个值，以及应该让它包含什么样的值</a></li>
          </ul>
        </li>
        <li><a href="#recover-捕获异常">Recover 捕获异常</a>
          <ul>
            <li><a href="#正确调用-recover-函数">正确调用 recover 函数</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="错误">
  错误
  <a class="anchor" href="#%e9%94%99%e8%af%af">#</a>
</h1>
<h2 id="error-类型">
  error 类型
  <a class="anchor" href="#error-%e7%b1%bb%e5%9e%8b">#</a>
</h2>
<p><code>error</code> 类型是内置的接口类型。<code>error</code> 类型可能是 <code>nil</code> 或者 <code>non-nil</code>，<code>nil</code> 表示成功。</p>
<h3 id="错误处理">
  错误处理
  <a class="anchor" href="#%e9%94%99%e8%af%af%e5%a4%84%e7%90%86">#</a>
</h3>
<p>当函数调用返回错误时，最常用的处理方式是<strong>传播错误</strong>，如。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#a6e22e">url</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span>{ <span style="color:#75715e">// 将这个HTTP错误返回给调用者
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">doc</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">html</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Body</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Body</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// fmt.Errorf函数使用fmt.Sprintf格式化错误信息并返回
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// 使用该函数前缀添加额外的上下文信息到原始错误信息。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;parsing %s as HTML: %v&#34;</span>, <span style="color:#a6e22e">url</span>,<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>由于错误信息经常是以链式组合在一起的，所以错误信息中应避免大写和换行符。</p>
<p>编写错误信息时，我们要确保错误信息对问题细节的描述是详尽的。尤其是要注意错误信息表达的一致性，即相同的函数或同包内
的同一组函数返回的错误在构成和处理方式上是相似的。</p>
<p>根据不同的场景，我们可能要对错误做些特殊处理，比如错误重试机制，或者打印错误日志，或者直接忽略错误。</p>
<h3 id="文件结尾错误">
  文件结尾错误
  <a class="anchor" href="#%e6%96%87%e4%bb%b6%e7%bb%93%e5%b0%be%e9%94%99%e8%af%af">#</a>
</h3>
<p><code>io</code> 包在任何由文件结束引起的读取失败都返回同一个错误 <code>io.EOF</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">in</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bufio</span>.<span style="color:#a6e22e">NewReader</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdin</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">in</span>.<span style="color:#a6e22e">ReadRune</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">EOF</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span> <span style="color:#75715e">// finished reading
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;read failed:%v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...use r…
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h2 id="panic-异常">
  Panic 异常
  <a class="anchor" href="#panic-%e5%bc%82%e5%b8%b8">#</a>
</h2>
<p>Go 运行时错误会引起 <code>painc</code> 异常。
一般而言，当 <code>panic</code> 异常发生时，程序会中断运行，并立即执行在该 goroutine 中被延迟的函数（<code>defer</code> 机制）。随后，程序崩溃
并输出日志信息。</p>
<p>由于 <code>panic</code> 会引起程序的崩溃，因此 <code>panic</code> 一般用于严重错误，如程序内部的逻辑不一致。但是对于大部分漏洞，我们应该使
用 Go 提供的错误机制，而不是 <code>panic</code>，尽量避免程序的崩溃。</p>
<h3 id="panic-函数">
  panic 函数
  <a class="anchor" href="#panic-%e5%87%bd%e6%95%b0">#</a>
</h3>
<p><code>panic</code> 函数接受任何值作为参数。当某些不应该发生的场景发生时，我们就应该调用 <code>panic</code>。</p>
<h3 id="panic-详情中都有什么">
  panic 详情中都有什么
  <a class="anchor" href="#panic-%e8%af%a6%e6%83%85%e4%b8%ad%e9%83%bd%e6%9c%89%e4%bb%80%e4%b9%88">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>panic: runtime error: index out of range
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>goroutine <span style="color:#ae81ff">1</span> <span style="color:#f92672">[</span>running<span style="color:#f92672">]</span>:
</span></span><span style="display:flex;"><span>main.main<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>/Users/haolin/GeekTime/Golang_Puzzlers/src/puzzlers/article19/q0/demo47.go:5 +0x3d
</span></span><span style="display:flex;"><span>exit status <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><p>第一行是 <code>panic: runtime error: index out of range</code>。其中的 <code>runtime error</code> 的含义是，这是一个 <code>runtime</code> 代码包中
抛出的<code> panic</code>。</p>
<p><code>goroutine 1 [running]</code>，它表示有一个 ID 为1的 goroutine 在此 <code>panic</code> 被引发的时候正在运行。这里的 ID 其实并不重要。</p>
<p><code>main.main()</code> 表明了这个 goroutine 包装的 go 函数就是命令源码文件中的那个<code>main</code>函数，也就是说这里的 goroutine 正
是<strong>主 goroutine</strong>。</p>
<p>再下面的一行，指出的就是这个 goroutine 中的哪一行代码在此 panic 被引发时正在执行。含了此行代码在其所属的源码文件中的行数，
以及这个源码文件的绝对路径。</p>
<p><code>+0x3d</code> 代表的是：此行代码相对于其所属函数的入口程序计数偏移量。用处并不大。</p>
<p><code>exit status 2</code> 表明我的这个程序是以退出状态码2结束运行的。<strong>在大多数操作系统中，只要退出状态码不是 0，都意味着程序运行的非正
常结束</strong>。在 Go 语言中，<strong>因 panic 导致程序结束运行的退出状态码一般都会是 2</strong>。</p>
<h3 id="从-panic-被引发到程序终止运行的大致过程是什么">
  从 panic 被引发到程序终止运行的大致过程是什么
  <a class="anchor" href="#%e4%bb%8e-panic-%e8%a2%ab%e5%bc%95%e5%8f%91%e5%88%b0%e7%a8%8b%e5%ba%8f%e7%bb%88%e6%ad%a2%e8%bf%90%e8%a1%8c%e7%9a%84%e5%a4%a7%e8%87%b4%e8%bf%87%e7%a8%8b%e6%98%af%e4%bb%80%e4%b9%88">#</a>
</h3>
<p>此行代码所属函数的执行随即终止。紧接着，控制权并不会在此有片刻停留，它又会立即转移至再上一级的调用代码处。控制权如此一级一
级地沿着调用栈的反方向传播至顶端，
也就是我们编写的最外层函数那里。</p>
<p>这里的最外层函数指的是go函数，对于主 goroutine 来说就是 <code>main</code> 函数。但是控制权也不会停留在那里，而是被 Go 语言运行时系统收回。</p>
<p>随后，程序崩溃并终止运行，承载程序这次运行的进程也会随之死亡并消失。与此同时，在这个控制权传播的过程中，panic 详情会被逐
渐地积累和完善，并会在程序终止之前被打印出来。</p>
<h3 id="怎样让-panic-包含一个值以及应该让它包含什么样的值">
  怎样让 panic 包含一个值，以及应该让它包含什么样的值
  <a class="anchor" href="#%e6%80%8e%e6%a0%b7%e8%ae%a9-panic-%e5%8c%85%e5%90%ab%e4%b8%80%e4%b8%aa%e5%80%bc%e4%bb%a5%e5%8f%8a%e5%ba%94%e8%af%a5%e8%ae%a9%e5%ae%83%e5%8c%85%e5%90%ab%e4%bb%80%e4%b9%88%e6%a0%b7%e7%9a%84%e5%80%bc">#</a>
</h3>
<p>其实很简单，在调用 <code>panic</code> 函数时，把某个值作为参数传给该函数就可以了。<code>panic</code> 函数的唯一一个参数是空接口
（也就是<code>interface{}</code>）类型的，所以从语法上讲，它可以接受任何类型的值。</p>
<p>但是，我们<strong>最好传入 <code>error</code> 类型的错误值，或者其他的可以被有效序列化的值。这里的“有效序列化”指的是，可以更易读地去表示
形式转换</strong>。</p>
<h2 id="recover-捕获异常">
  Recover 捕获异常
  <a class="anchor" href="#recover-%e6%8d%95%e8%8e%b7%e5%bc%82%e5%b8%b8">#</a>
</h2>
<p>一般情况下，我们不能因为某个处理函数引发的 <code>panic</code> 异常，杀掉整个进程，可以使用 <code>recover</code> 函数恢复 <code>panic</code> 异常。</p>
<p><code>panic</code> 时会调用 <code>recover</code>，但是 <code>recover</code> 不能滥用，可能会引起资源泄漏或者其他问题。我们可以将 <code>panic value</code> 设置成特
殊类型，来标识某个 <code>panic</code> 是否应该被恢复。<strong><code>recover</code> 只能在 <code>defer</code> 修饰的函数中使用</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">soleTitle</span>(<span style="color:#a6e22e">doc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">html</span>.<span style="color:#a6e22e">Node</span>) (<span style="color:#a6e22e">title</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">bailout</span> <span style="color:#66d9ef">struct</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> recover(); <span style="color:#a6e22e">p</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">nil</span>:       <span style="color:#75715e">// no panic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">bailout</span>{}: <span style="color:#75715e">// &#34;expected&#34; panic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;multiple title elements&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">default</span>:
</span></span><span style="display:flex;"><span>                panic(<span style="color:#a6e22e">p</span>) <span style="color:#75715e">// unexpected panic; carry on panicking
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		}
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>    panic(<span style="color:#a6e22e">bailout</span>{}) 
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>上面的代码，<code>deferred</code> 函数调用 <code>recover</code>，并检查 <code>panic value</code>。当 <code>panic value</code> 是 <code>bailout{}</code> 类型时，<code>deferred</code> 函数生
成一个 <code>error</code> 返回给调用者。
当 <code>panic value</code> 是其他 <code>non-nil</code> 值时，表示发生了未知的 <code>panic</code> 异常。</p>
<h3 id="正确调用-recover-函数">
  正确调用 recover 函数
  <a class="anchor" href="#%e6%ad%a3%e7%a1%ae%e8%b0%83%e7%94%a8-recover-%e5%87%bd%e6%95%b0">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;errors&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Enter function main.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 引发 panic。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    panic(<span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;something wrong&#34;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> recover()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;panic: %s\n&#34;</span>, <span style="color:#a6e22e">p</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Exit function main.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>上面的代码，<code>recover</code> 函数调用并不会起到任何作用，甚至都没有机会执行。因为 panic 一旦发生，控制权就会讯速地沿着调用栈的反方向
传播。所以，<strong>在 panic 函数调用之后的代码，根本就没有执行的机会</strong>。</p>
<p>先调用 <code>recover</code> 函数，再调用 <code>panic</code> 函数会怎么样呢？
如果在我们调用 <code>recover</code> 函数时未发生 panic，那么该函数就不会做任何事情，并且只会返回一个 <code>nil</code>。</p>
<p><strong><code>defer</code> 语句调用 <code>recover</code> 函数才是正确的打开方式</strong>。</p>
<p>无论函数结束执行的原因是什么，其中的 <code>defer</code> 函数调用都会在它即将结束执行的那一刻执行。即使导致它执行结束的原因是一
个 panic 也会是这样。</p>
<p>要注意，我们要<strong>尽量把 <code>defer</code> 语句写在函数体的开始处，因为在引发 panic 的语句之后的所有语句，都不会有任何执行机会</strong>。</p>
<p>注意下面的方式，也是无法捕获 panic 的：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> recover(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;recover: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }()
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    panic(<span style="color:#e6db74">&#34;EDDYCJY.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>因为 <strong><code>panic</code> 发生时，程序会中断运行，并执行在当前 goroutine 中 <code>defer</code> 的函数</strong>，新起一个 goroutine 中的 <code>defer</code>
函数并不会执行。</p>
<p><strong>注意连续调用 <code>panic</code> 只有最后一个会被 <code>recover</code> 捕获</strong>。</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/shipengqi/golang-learn/commit/44c3ee763ef8b1ef68e8f73c9152c5aa565995fc" title='Last modified by shipengqi | October 7, 2023' target="_blank" rel="noopener">
      <img src="/golang-learn/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>October 7, 2023</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/shipengqi/golang-learn/edit/master/content/content/docs/basic/error.md" target="_blank" rel="noopener">
      <img src="/golang-learn/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#错误">错误</a>
      <ul>
        <li><a href="#error-类型">error 类型</a>
          <ul>
            <li><a href="#错误处理">错误处理</a></li>
            <li><a href="#文件结尾错误">文件结尾错误</a></li>
          </ul>
        </li>
        <li><a href="#panic-异常">Panic 异常</a>
          <ul>
            <li><a href="#panic-函数">panic 函数</a></li>
            <li><a href="#panic-详情中都有什么">panic 详情中都有什么</a></li>
            <li><a href="#从-panic-被引发到程序终止运行的大致过程是什么">从 panic 被引发到程序终止运行的大致过程是什么</a></li>
            <li><a href="#怎样让-panic-包含一个值以及应该让它包含什么样的值">怎样让 panic 包含一个值，以及应该让它包含什么样的值</a></li>
          </ul>
        </li>
        <li><a href="#recover-捕获异常">Recover 捕获异常</a>
          <ul>
            <li><a href="#正确调用-recover-函数">正确调用 recover 函数</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












